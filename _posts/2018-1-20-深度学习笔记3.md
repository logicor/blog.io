
#深度学习笔记3

<p>例如将法语翻译成英语： <br>
<img src="https://img-blog.csdn.net/20180305191120147?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvd2VpeGluXzQxMDQzMjQw/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述" title=""> <br>
首先将法语单词逐个输入到CNN，这部分称为encoder network，然后一次输出一个英语单词，这部分称为decoder network。 <br>
<img src="https://img-blog.csdn.net/20180305191342489?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvd2VpeGluXzQxMDQzMjQw/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述" title=""> <br>
CNN结合RNN解读图片内容，如上图输入一副图像，生成一句描述图像的句子。</p>



<h1 id="2picking-the-most-likely-sentence最优句子"><a name="t1"></a>2.Picking the most likely sentence最优句子</h1>

<p><img src="https://img-blog.csdn.net/20180324144604173?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MTA0MzI0MA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述" title=""> <br>
如图，是语言模型和机器翻译的流程对比，可以发现语言模型和机器翻译的decoder network部分非常相似，区别是语言模型的输入为0向量，所以输出为随机的一句话的概率。而机器翻译decoder network输入是非零向量，如果将机器翻译的encoder结果输入语言模型，语言模型的输出就是有输入决定的几句话的概率，称之为条件语言模型。</p>

<p>那么在输出的几句话中，如何选择最佳的一句呢？ <br>
<img src="https://img-blog.csdn.net/20180324145945676?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MTA0MzI0MA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述" title=""> <br>
也就是找到能使条件概率最大的的序列，通常做法为Beam search集束搜索，下一节会讲。</p>

<p>为什么不用greedy search贪婪搜索呢？ <br>
贪婪搜索就是逐词的找到其概率最大的那个词，也就是先确定第一个词，找到其概率最大的词，然后确定第二个、第三个直到最后一个，这样产生的结果也不错，但我们需要的是最优序列，事实证明这样搜索通常很难找到我们所要的最佳序列</p>



<h1 id="3-序列模型-定向搜索"><a name="t2"></a>3. 序列模型—-定向搜索</h1>

<p>Beam search集束搜索： <br>
集束搜索也是逐词确定，但是与贪心搜索不同的是，它设置参数B（集束宽），对每个位置的词选择多个可能性较大的词，如B=3，那么对于第一个词来说，选择3个可能性最大的词，存到内存。 <br>
具体做法是： <br>
1）将法语句子输入encoder network，然后输入softmax，输出第一个词<span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-3-Frame" tabindex="0" style="position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msup><mi>y</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;lt;</mo><mn>1</mn><mo>&amp;gt;</mo></mrow></msup></math>" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1" style="width: 2.503em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.083em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.197em, 1002.08em, 2.549em, -1000em); top: -2.188em; left: 0em;"><span class="mrow" id="MathJax-Span-2"><span class="msubsup" id="MathJax-Span-3"><span style="display: inline-block; position: relative; width: 2.077em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.5em, 4.372em, -1000em); top: -4.01em; left: 0em;"><span class="mi" id="MathJax-Span-4" style="font-family: MathJax_Math; font-style: italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.006em;"></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span><span style="position: absolute; top: -4.373em; left: 0.548em;"><span class="texatom" id="MathJax-Span-5"><span class="mrow" id="MathJax-Span-6"><span class="mo" id="MathJax-Span-7" style="font-size: 70.7%; font-family: MathJax_Main;">&lt;</span><span class="mn" id="MathJax-Span-8" style="font-size: 70.7%; font-family: MathJax_Main;">1</span><span class="mo" id="MathJax-Span-9" style="font-size: 70.7%; font-family: MathJax_Main;">&gt;</span></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.188em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.308em; border-left: 0px solid; width: 0px; height: 1.372em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mi>y</mi><mrow class="MJX-TeXAtom-ORD"><mo>&lt;</mo><mn>1</mn><mo>&gt;</mo></mrow></msup></math></span></span><script type="math/tex" id="MathJax-Element-3">y^{<1>}</script>的10000(词典长度)概率值<span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-4-Frame" tabindex="0" style="position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>P</mi><mo stretchy=&quot;false&quot;>(</mo><msup><mi>y</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;lt;</mo><mn>1</mn><mo>&amp;gt;</mo></mrow></msup><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo stretchy=&quot;false&quot;>|</mo></mrow><mi>x</mi><mo stretchy=&quot;false&quot;>)</mo></math>" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-10" style="width: 5.419em; display: inline-block;"><span style="display: inline-block; position: relative; width: 4.479em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.302em, 1004.38em, 2.698em, -1000em); top: -2.292em; left: 0em;"><span class="mrow" id="MathJax-Span-11"><span class="mi" id="MathJax-Span-12" style="font-family: MathJax_Math; font-style: italic;">P<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.109em;"></span></span><span class="mo" id="MathJax-Span-13" style="font-family: MathJax_Main;">(</span><span class="msubsup" id="MathJax-Span-14"><span style="display: inline-block; position: relative; width: 2.077em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.5em, 4.372em, -1000em); top: -4.01em; left: 0em;"><span class="mi" id="MathJax-Span-15" style="font-family: MathJax_Math; font-style: italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.006em;"></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span><span style="position: absolute; top: -4.373em; left: 0.548em;"><span class="texatom" id="MathJax-Span-16"><span class="mrow" id="MathJax-Span-17"><span class="mo" id="MathJax-Span-18" style="font-size: 70.7%; font-family: MathJax_Main;">&lt;</span><span class="mn" id="MathJax-Span-19" style="font-size: 70.7%; font-family: MathJax_Main;">1</span><span class="mo" id="MathJax-Span-20" style="font-size: 70.7%; font-family: MathJax_Main;">&gt;</span></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span></span></span><span class="texatom" id="MathJax-Span-21"><span class="mrow" id="MathJax-Span-22"><span class="mo" id="MathJax-Span-23" style="font-family: MathJax_Main;">|</span></span></span><span class="mi" id="MathJax-Span-24" style="font-family: MathJax_Math; font-style: italic;">x</span><span class="mo" id="MathJax-Span-25" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.292em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.362em; border-left: 0px solid; width: 0px; height: 1.426em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>P</mi><mo stretchy="false">(</mo><msup><mi>y</mi><mrow class="MJX-TeXAtom-ORD"><mo>&lt;</mo><mn>1</mn><mo>&gt;</mo></mrow></msup><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><mi>x</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-4">P(y^{<1>}|x)</script>，取前三个存起来。比如in,jane,september； <br>
<img src="https://img-blog.csdn.net/20180324122934437?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MTA0MzI0MA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述" title=""> <br>
2）第二步是要选择第一个词和第二个词组合的可能性最大的前三个，第一个词有3种可能，对于每种可能，作为输入代入decoder的下一个单元，产生10000个概率值，也就是一共3*10000=30000个概率值<span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-5-Frame" tabindex="0" style="position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>P</mi><mo stretchy=&quot;false&quot;>(</mo><msup><mi>y</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;lt;</mo><mn>2</mn><mo>&amp;gt;</mo></mrow></msup><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo stretchy=&quot;false&quot;>|</mo></mrow><mi>x</mi><mo>,</mo><msup><mi>y</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;lt;</mo><mn>1</mn><mo>&amp;gt;</mo></mrow></msup><mo stretchy=&quot;false&quot;>)</mo></math>" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-26" style="width: 8.388em; display: inline-block;"><span style="display: inline-block; position: relative; width: 6.979em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.302em, 1006.88em, 2.698em, -1000em); top: -2.292em; left: 0em;"><span class="mrow" id="MathJax-Span-27"><span class="mi" id="MathJax-Span-28" style="font-family: MathJax_Math; font-style: italic;">P<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.109em;"></span></span><span class="mo" id="MathJax-Span-29" style="font-family: MathJax_Main;">(</span><span class="msubsup" id="MathJax-Span-30"><span style="display: inline-block; position: relative; width: 2.077em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.5em, 4.372em, -1000em); top: -4.01em; left: 0em;"><span class="mi" id="MathJax-Span-31" style="font-family: MathJax_Math; font-style: italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.006em;"></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span><span style="position: absolute; top: -4.373em; left: 0.548em;"><span class="texatom" id="MathJax-Span-32"><span class="mrow" id="MathJax-Span-33"><span class="mo" id="MathJax-Span-34" style="font-size: 70.7%; font-family: MathJax_Main;">&lt;</span><span class="mn" id="MathJax-Span-35" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span class="mo" id="MathJax-Span-36" style="font-size: 70.7%; font-family: MathJax_Main;">&gt;</span></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span></span></span><span class="texatom" id="MathJax-Span-37"><span class="mrow" id="MathJax-Span-38"><span class="mo" id="MathJax-Span-39" style="font-family: MathJax_Main;">|</span></span></span><span class="mi" id="MathJax-Span-40" style="font-family: MathJax_Math; font-style: italic;">x</span><span class="mo" id="MathJax-Span-41" style="font-family: MathJax_Main;">,</span><span class="msubsup" id="MathJax-Span-42" style="padding-left: 0.167em;"><span style="display: inline-block; position: relative; width: 2.077em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.5em, 4.372em, -1000em); top: -4.01em; left: 0em;"><span class="mi" id="MathJax-Span-43" style="font-family: MathJax_Math; font-style: italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.006em;"></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span><span style="position: absolute; top: -4.373em; left: 0.548em;"><span class="texatom" id="MathJax-Span-44"><span class="mrow" id="MathJax-Span-45"><span class="mo" id="MathJax-Span-46" style="font-size: 70.7%; font-family: MathJax_Main;">&lt;</span><span class="mn" id="MathJax-Span-47" style="font-size: 70.7%; font-family: MathJax_Main;">1</span><span class="mo" id="MathJax-Span-48" style="font-size: 70.7%; font-family: MathJax_Main;">&gt;</span></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span></span></span><span class="mo" id="MathJax-Span-49" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.292em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.362em; border-left: 0px solid; width: 0px; height: 1.426em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>P</mi><mo stretchy="false">(</mo><msup><mi>y</mi><mrow class="MJX-TeXAtom-ORD"><mo>&lt;</mo><mn>2</mn><mo>&gt;</mo></mrow></msup><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><mi>x</mi><mo>,</mo><msup><mi>y</mi><mrow class="MJX-TeXAtom-ORD"><mo>&lt;</mo><mn>1</mn><mo>&gt;</mo></mrow></msup><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-5">P(y^{<2>}|x,y^{<1>})</script>，然后计算组合概率，公式如下： <br>
<span class="MathJax_Preview" style="color: inherit; display: none;"></span></p><div class="MathJax_Display" style="text-align: center;"></div><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-6-Frame" tabindex="0" style="text-align: center; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mi>P</mi><mo stretchy=&quot;false&quot;>(</mo><msup><mi>y</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;lt;</mo><mn>1</mn><mo>&amp;gt;</mo></mrow></msup><mo>,</mo><msup><mi>y</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;lt;</mo><mn>2</mn><mo>&amp;gt;</mo></mrow></msup><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo stretchy=&quot;false&quot;>|</mo></mrow><mi>x</mi><mo stretchy=&quot;false&quot;>)</mo><mo>=</mo><mi>P</mi><mo stretchy=&quot;false&quot;>(</mo><msup><mi>y</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;lt;</mo><mn>1</mn><mo>&amp;gt;</mo></mrow></msup><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo stretchy=&quot;false&quot;>|</mo></mrow><mi>x</mi><mo stretchy=&quot;false&quot;>)</mo><mo>&amp;#x2217;</mo><mi>P</mi><mo stretchy=&quot;false&quot;>(</mo><msup><mi>y</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;lt;</mo><mn>2</mn><mo>&amp;gt;</mo></mrow></msup><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo stretchy=&quot;false&quot;>|</mo></mrow><mi>x</mi><mo>,</mo><msup><mi>y</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;lt;</mo><mn>1</mn><mo>&amp;gt;</mo></mrow></msup><mo stretchy=&quot;false&quot;>)</mo></math>" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-50" style="width: 24.846em; display: inline-block;"><span style="display: inline-block; position: relative; width: 20.677em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.252em, 1020.58em, 2.698em, -1000em); top: -2.292em; left: 0em;"><span class="mrow" id="MathJax-Span-51"><span class="mi" id="MathJax-Span-52" style="font-family: MathJax_Math; font-style: italic;">P<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.109em;"></span></span><span class="mo" id="MathJax-Span-53" style="font-family: MathJax_Main;">(</span><span class="msubsup" id="MathJax-Span-54"><span style="display: inline-block; position: relative; width: 2.077em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.5em, 4.372em, -1000em); top: -4.01em; left: 0em;"><span class="mi" id="MathJax-Span-55" style="font-family: MathJax_Math; font-style: italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.006em;"></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span><span style="position: absolute; top: -4.423em; left: 0.548em;"><span class="texatom" id="MathJax-Span-56"><span class="mrow" id="MathJax-Span-57"><span class="mo" id="MathJax-Span-58" style="font-size: 70.7%; font-family: MathJax_Main;">&lt;</span><span class="mn" id="MathJax-Span-59" style="font-size: 70.7%; font-family: MathJax_Main;">1</span><span class="mo" id="MathJax-Span-60" style="font-size: 70.7%; font-family: MathJax_Main;">&gt;</span></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span></span></span><span class="mo" id="MathJax-Span-61" style="font-family: MathJax_Main;">,</span><span class="msubsup" id="MathJax-Span-62" style="padding-left: 0.167em;"><span style="display: inline-block; position: relative; width: 2.077em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.5em, 4.372em, -1000em); top: -4.01em; left: 0em;"><span class="mi" id="MathJax-Span-63" style="font-family: MathJax_Math; font-style: italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.006em;"></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span><span style="position: absolute; top: -4.423em; left: 0.548em;"><span class="texatom" id="MathJax-Span-64"><span class="mrow" id="MathJax-Span-65"><span class="mo" id="MathJax-Span-66" style="font-size: 70.7%; font-family: MathJax_Main;">&lt;</span><span class="mn" id="MathJax-Span-67" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span class="mo" id="MathJax-Span-68" style="font-size: 70.7%; font-family: MathJax_Main;">&gt;</span></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span></span></span><span class="texatom" id="MathJax-Span-69"><span class="mrow" id="MathJax-Span-70"><span class="mo" id="MathJax-Span-71" style="font-family: MathJax_Main;">|</span></span></span><span class="mi" id="MathJax-Span-72" style="font-family: MathJax_Math; font-style: italic;">x</span><span class="mo" id="MathJax-Span-73" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-74" style="font-family: MathJax_Main; padding-left: 0.278em;">=</span><span class="mi" id="MathJax-Span-75" style="font-family: MathJax_Math; font-style: italic; padding-left: 0.278em;">P<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.109em;"></span></span><span class="mo" id="MathJax-Span-76" style="font-family: MathJax_Main;">(</span><span class="msubsup" id="MathJax-Span-77"><span style="display: inline-block; position: relative; width: 2.077em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.5em, 4.372em, -1000em); top: -4.01em; left: 0em;"><span class="mi" id="MathJax-Span-78" style="font-family: MathJax_Math; font-style: italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.006em;"></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span><span style="position: absolute; top: -4.423em; left: 0.548em;"><span class="texatom" id="MathJax-Span-79"><span class="mrow" id="MathJax-Span-80"><span class="mo" id="MathJax-Span-81" style="font-size: 70.7%; font-family: MathJax_Main;">&lt;</span><span class="mn" id="MathJax-Span-82" style="font-size: 70.7%; font-family: MathJax_Main;">1</span><span class="mo" id="MathJax-Span-83" style="font-size: 70.7%; font-family: MathJax_Main;">&gt;</span></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span></span></span><span class="texatom" id="MathJax-Span-84"><span class="mrow" id="MathJax-Span-85"><span class="mo" id="MathJax-Span-86" style="font-family: MathJax_Main;">|</span></span></span><span class="mi" id="MathJax-Span-87" style="font-family: MathJax_Math; font-style: italic;">x</span><span class="mo" id="MathJax-Span-88" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-89" style="font-family: MathJax_Main; padding-left: 0.222em;">∗</span><span class="mi" id="MathJax-Span-90" style="font-family: MathJax_Math; font-style: italic; padding-left: 0.222em;">P<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.109em;"></span></span><span class="mo" id="MathJax-Span-91" style="font-family: MathJax_Main;">(</span><span class="msubsup" id="MathJax-Span-92"><span style="display: inline-block; position: relative; width: 2.077em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.5em, 4.372em, -1000em); top: -4.01em; left: 0em;"><span class="mi" id="MathJax-Span-93" style="font-family: MathJax_Math; font-style: italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.006em;"></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span><span style="position: absolute; top: -4.423em; left: 0.548em;"><span class="texatom" id="MathJax-Span-94"><span class="mrow" id="MathJax-Span-95"><span class="mo" id="MathJax-Span-96" style="font-size: 70.7%; font-family: MathJax_Main;">&lt;</span><span class="mn" id="MathJax-Span-97" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span class="mo" id="MathJax-Span-98" style="font-size: 70.7%; font-family: MathJax_Main;">&gt;</span></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span></span></span><span class="texatom" id="MathJax-Span-99"><span class="mrow" id="MathJax-Span-100"><span class="mo" id="MathJax-Span-101" style="font-family: MathJax_Main;">|</span></span></span><span class="mi" id="MathJax-Span-102" style="font-family: MathJax_Math; font-style: italic;">x</span><span class="mo" id="MathJax-Span-103" style="font-family: MathJax_Main;">,</span><span class="msubsup" id="MathJax-Span-104" style="padding-left: 0.167em;"><span style="display: inline-block; position: relative; width: 2.077em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.5em, 4.372em, -1000em); top: -4.01em; left: 0em;"><span class="mi" id="MathJax-Span-105" style="font-family: MathJax_Math; font-style: italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.006em;"></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span><span style="position: absolute; top: -4.423em; left: 0.548em;"><span class="texatom" id="MathJax-Span-106"><span class="mrow" id="MathJax-Span-107"><span class="mo" id="MathJax-Span-108" style="font-size: 70.7%; font-family: MathJax_Main;">&lt;</span><span class="mn" id="MathJax-Span-109" style="font-size: 70.7%; font-family: MathJax_Main;">1</span><span class="mo" id="MathJax-Span-110" style="font-size: 70.7%; font-family: MathJax_Main;">&gt;</span></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span></span></span><span class="mo" id="MathJax-Span-111" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.292em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.362em; border-left: 0px solid; width: 0px; height: 1.486em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>P</mi><mo stretchy="false">(</mo><msup><mi>y</mi><mrow class="MJX-TeXAtom-ORD"><mo>&lt;</mo><mn>1</mn><mo>&gt;</mo></mrow></msup><mo>,</mo><msup><mi>y</mi><mrow class="MJX-TeXAtom-ORD"><mo>&lt;</mo><mn>2</mn><mo>&gt;</mo></mrow></msup><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><mi>x</mi><mo stretchy="false">)</mo><mo>=</mo><mi>P</mi><mo stretchy="false">(</mo><msup><mi>y</mi><mrow class="MJX-TeXAtom-ORD"><mo>&lt;</mo><mn>1</mn><mo>&gt;</mo></mrow></msup><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><mi>x</mi><mo stretchy="false">)</mo><mo>∗</mo><mi>P</mi><mo stretchy="false">(</mo><msup><mi>y</mi><mrow class="MJX-TeXAtom-ORD"><mo>&lt;</mo><mn>2</mn><mo>&gt;</mo></mrow></msup><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><mi>x</mi><mo>,</mo><msup><mi>y</mi><mrow class="MJX-TeXAtom-ORD"><mo>&lt;</mo><mn>1</mn><mo>&gt;</mo></mrow></msup><mo stretchy="false">)</mo></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-6">P(y^{<1>},y^{<2>}|x) = P(y^{<1>}|x)*P(y^{<2>}|x,y^{<1>})</script> <br>
选择概率最大的前3个，存入内存。 <br>
<img src="https://img-blog.csdn.net/20180324123103301?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MTA0MzI0MA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述" title=""> <br>
<img src="https://img-blog.csdn.net/20180324123000757?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MTA0MzI0MA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述" title=""><p></p>



<h1 id="4-序列模型-改进定向搜索"><a name="t3"></a>4. 序列模型—-改进定向搜索</h1>



<h4 id="长度归一化length-normalization">长度归一化（length normalization）</h4>

<p>定向搜索的目标是要最大化条件概率： <br>
<span class="MathJax_Preview" style="color: inherit; display: none;"></span></p><div class="MathJax_Display" style="text-align: center;"></div><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-7-Frame" tabindex="0" style="text-align: center; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mi>a</mi><mi>r</mi><mi>g</mi><munder><mo movablelimits=&quot;true&quot; form=&quot;prefix&quot;>max</mo><mi>y</mi></munder><munderover><mo>&amp;#x220F;</mo><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>t</mi><mo>=</mo><mn>1</mn></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><msub><mi>T</mi><mi>y</mi></msub></mrow></munderover><mi>P</mi><mo stretchy=&quot;false&quot;>(</mo><msup><mi>y</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;lt;</mo><mi>t</mi><mo>&amp;gt;</mo></mrow></msup><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo stretchy=&quot;false&quot;>|</mo></mrow><mi>x</mi><mo>,</mo><msup><mi>y</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;lt;</mo><mn>1</mn><mo>&amp;gt;</mo></mrow></msup><mo>&amp;#x2026;</mo><msup><mi>y</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;lt;</mo><mi>t</mi><mo>&amp;#x2212;</mo><mn>1</mn><mo>&amp;gt;</mo></mrow></msup><mo stretchy=&quot;false&quot;>)</mo></math>" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-112" style="width: 19.638em; display: inline-block;"><span style="display: inline-block; position: relative; width: 16.354em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(0.287em, 1016.26em, 3.643em, -1000em); top: -2.292em; left: 0em;"><span class="mrow" id="MathJax-Span-113"><span class="mi" id="MathJax-Span-114" style="font-family: MathJax_Math; font-style: italic;">a</span><span class="mi" id="MathJax-Span-115" style="font-family: MathJax_Math; font-style: italic;">r</span><span class="mi" id="MathJax-Span-116" style="font-family: MathJax_Math; font-style: italic;">g<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="munderover" id="MathJax-Span-117" style="padding-left: 0.167em;"><span style="display: inline-block; position: relative; width: 1.861em; height: 0px;"><span style="position: absolute; clip: rect(3.406em, 1001.85em, 4.178em, -1000em); top: -4.01em; left: 0em;"><span class="mo" id="MathJax-Span-118" style="font-family: MathJax_Main;">max</span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span><span style="position: absolute; clip: rect(3.542em, 1000.35em, 4.412em, -1000em); top: -3.399em; left: 0.755em;"><span class="mi" id="MathJax-Span-119" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.004em;"></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span></span></span><span class="munderover" id="MathJax-Span-120" style="padding-left: 0.167em;"><span style="display: inline-block; position: relative; width: 1.278em; height: 0px;"><span style="position: absolute; clip: rect(2.904em, 1001.22em, 4.617em, -1000em); top: -4.01em; left: 0em;"><span class="mo" id="MathJax-Span-121" style="font-family: MathJax_Size2; vertical-align: 0em;">∏</span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span><span style="position: absolute; clip: rect(3.383em, 1001.11em, 4.274em, -1000em); top: -2.923em; left: 0.06em;"><span class="texatom" id="MathJax-Span-122"><span class="mrow" id="MathJax-Span-123"><span class="mi" id="MathJax-Span-124" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">t</span><span class="mo" id="MathJax-Span-125" style="font-size: 70.7%; font-family: MathJax_Main;">=</span><span class="mn" id="MathJax-Span-126" style="font-size: 70.7%; font-family: MathJax_Main;">1</span></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span><span style="position: absolute; clip: rect(3.275em, 1000.71em, 4.375em, -1000em); top: -5.28em; left: 0.282em;"><span class="texatom" id="MathJax-Span-127"><span class="mrow" id="MathJax-Span-128"><span class="msubsup" id="MathJax-Span-129"><span style="display: inline-block; position: relative; width: 0.714em; height: 0px;"><span style="position: absolute; clip: rect(3.375em, 1000.5em, 4.167em, -1000em); top: -4.01em; left: 0em;"><span class="mi" id="MathJax-Span-130" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">T<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.085em;"></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span><span style="position: absolute; top: -3.904em; left: 0.413em;"><span class="mi" id="MathJax-Span-131" style="font-size: 50%; font-family: MathJax_Math; font-style: italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span></span></span><span class="mi" id="MathJax-Span-132" style="font-family: MathJax_Math; font-style: italic; padding-left: 0.167em;">P<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.109em;"></span></span><span class="mo" id="MathJax-Span-133" style="font-family: MathJax_Main;">(</span><span class="msubsup" id="MathJax-Span-134"><span style="display: inline-block; position: relative; width: 1.978em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.5em, 4.372em, -1000em); top: -4.01em; left: 0em;"><span class="mi" id="MathJax-Span-135" style="font-family: MathJax_Math; font-style: italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.006em;"></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span><span style="position: absolute; top: -4.423em; left: 0.548em;"><span class="texatom" id="MathJax-Span-136"><span class="mrow" id="MathJax-Span-137"><span class="mo" id="MathJax-Span-138" style="font-size: 70.7%; font-family: MathJax_Main;">&lt;</span><span class="mi" id="MathJax-Span-139" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">t</span><span class="mo" id="MathJax-Span-140" style="font-size: 70.7%; font-family: MathJax_Main;">&gt;</span></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span></span></span><span class="texatom" id="MathJax-Span-141"><span class="mrow" id="MathJax-Span-142"><span class="mo" id="MathJax-Span-143" style="font-family: MathJax_Main;">|</span></span></span><span class="mi" id="MathJax-Span-144" style="font-family: MathJax_Math; font-style: italic;">x</span><span class="mo" id="MathJax-Span-145" style="font-family: MathJax_Main;">,</span><span class="msubsup" id="MathJax-Span-146" style="padding-left: 0.167em;"><span style="display: inline-block; position: relative; width: 2.077em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.5em, 4.372em, -1000em); top: -4.01em; left: 0em;"><span class="mi" id="MathJax-Span-147" style="font-family: MathJax_Math; font-style: italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.006em;"></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span><span style="position: absolute; top: -4.423em; left: 0.548em;"><span class="texatom" id="MathJax-Span-148"><span class="mrow" id="MathJax-Span-149"><span class="mo" id="MathJax-Span-150" style="font-size: 70.7%; font-family: MathJax_Main;">&lt;</span><span class="mn" id="MathJax-Span-151" style="font-size: 70.7%; font-family: MathJax_Main;">1</span><span class="mo" id="MathJax-Span-152" style="font-size: 70.7%; font-family: MathJax_Main;">&gt;</span></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span></span></span><span class="mo" id="MathJax-Span-153" style="font-family: MathJax_Main; padding-left: 0.167em;">…</span><span class="msubsup" id="MathJax-Span-154" style="padding-left: 0.167em;"><span style="display: inline-block; position: relative; width: 2.882em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.5em, 4.372em, -1000em); top: -4.01em; left: 0em;"><span class="mi" id="MathJax-Span-155" style="font-family: MathJax_Math; font-style: italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.006em;"></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span><span style="position: absolute; top: -4.423em; left: 0.548em;"><span class="texatom" id="MathJax-Span-156"><span class="mrow" id="MathJax-Span-157"><span class="mo" id="MathJax-Span-158" style="font-size: 70.7%; font-family: MathJax_Main;">&lt;</span><span class="mi" id="MathJax-Span-159" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">t</span><span class="mo" id="MathJax-Span-160" style="font-size: 70.7%; font-family: MathJax_Main;">−</span><span class="mn" id="MathJax-Span-161" style="font-size: 70.7%; font-family: MathJax_Main;">1</span><span class="mo" id="MathJax-Span-162" style="font-size: 70.7%; font-family: MathJax_Main;">&gt;</span></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span></span></span><span class="mo" id="MathJax-Span-163" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.292em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -1.497em; border-left: 0px solid; width: 0px; height: 3.778em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>a</mi><mi>r</mi><mi>g</mi><munder><mo movablelimits="true" form="prefix">max</mo><mi>y</mi></munder><munderover><mo>∏</mo><mrow class="MJX-TeXAtom-ORD"><mi>t</mi><mo>=</mo><mn>1</mn></mrow><mrow class="MJX-TeXAtom-ORD"><msub><mi>T</mi><mi>y</mi></msub></mrow></munderover><mi>P</mi><mo stretchy="false">(</mo><msup><mi>y</mi><mrow class="MJX-TeXAtom-ORD"><mo>&lt;</mo><mi>t</mi><mo>&gt;</mo></mrow></msup><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><mi>x</mi><mo>,</mo><msup><mi>y</mi><mrow class="MJX-TeXAtom-ORD"><mo>&lt;</mo><mn>1</mn><mo>&gt;</mo></mrow></msup><mo>…</mo><msup><mi>y</mi><mrow class="MJX-TeXAtom-ORD"><mo>&lt;</mo><mi>t</mi><mo>−</mo><mn>1</mn><mo>&gt;</mo></mrow></msup><mo stretchy="false">)</mo></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-7">arg\max_y \prod_{t=1}^{T_y}P(y^{<t>}|x, y^{<1>}…y^{<t-1>})</script> <br>
<span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_Display"></div><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_Display"><span class="MathJax MathJax_FullWidth" id="MathJax-Element-8-Frame" tabindex="0" style="position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><munderover><mo>&amp;#x220F;</mo><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>t</mi><mo>=</mo><mn>1</mn></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><msub><mi>T</mi><mi>y</mi></msub></mrow></munderover><mi>P</mi><mo stretchy=&quot;false&quot;>(</mo><msup><mi>y</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;lt;</mo><mi>t</mi><mo>&amp;gt;</mo></mrow></msup><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo stretchy=&quot;false&quot;>|</mo></mrow><mi>x</mi><mo>,</mo><msup><mi>y</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;lt;</mo><mn>1</mn><mo>&amp;gt;</mo></mrow></msup><mo>&amp;#x2026;</mo><msup><mi>y</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;lt;</mo><mi>t</mi><mo>&amp;#x2212;</mo><mn>1</mn><mo>&amp;gt;</mo></mrow></msup><mo stretchy=&quot;false&quot;>)</mo><mo>=</mo><mi>P</mi><mo stretchy=&quot;false&quot;>(</mo><msup><mi>y</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;lt;</mo><mn>1</mn><mo>&amp;gt;</mo></mrow></msup><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo stretchy=&quot;false&quot;>|</mo></mrow><mi>x</mi><mo stretchy=&quot;false&quot;>)</mo><mo>&amp;#x2217;</mo><mi>P</mi><mo stretchy=&quot;false&quot;>(</mo><msup><mi>y</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;lt;</mo><mn>2</mn><mo>&amp;gt;</mo></mrow></msup><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo stretchy=&quot;false&quot;>|</mo></mrow><mi>x</mi><mo>,</mo><msup><mi>y</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;lt;</mo><mn>1</mn><mo>&amp;gt;</mo></mrow></msup><mo stretchy=&quot;false&quot;>)</mo><mo>&amp;#x2217;</mo><mo>&amp;#x2026;</mo><mi>P</mi><mo stretchy=&quot;false&quot;>(</mo><msup><mi>y</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;lt;</mo><mi>t</mi><mo>&amp;gt;</mo></mrow></msup><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo stretchy=&quot;false&quot;>|</mo></mrow><mi>x</mi><mo>,</mo><msup><mi>y</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;lt;</mo><mn>1</mn><mo>&amp;gt;</mo></mrow></msup><mo>&amp;#x2026;</mo><msup><mi>y</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;lt;</mo><mi>t</mi><mo>&amp;#x2212;</mo><mn>1</mn><mo>&amp;gt;</mo></mrow></msup><mo stretchy=&quot;false&quot;>)</mo></math>" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-164" style="width: 100%; display: inline-block; min-width: 32.607em;"><span style="display: inline-block; position: relative; width: 100%; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(3.62em, 1027.08em, 8.541em, -1000em); top: -5.625em; left: 0em; width: 100%;"><span class="mrow" id="MathJax-Span-165"><span style="display: inline-block; position: relative; width: 100%; height: 0px;"><span style="position: absolute; clip: rect(2.058em, 1027.08em, 5.414em, -1000em); top: -4.063em; left: 50%; margin-left: -13.572em;"><span class="munderover" id="MathJax-Span-166"><span style="display: inline-block; position: relative; width: 1.278em; height: 0px;"><span style="position: absolute; clip: rect(2.904em, 1001.22em, 4.617em, -1000em); top: -4.01em; left: 0em;"><span class="mo" id="MathJax-Span-167" style="font-family: MathJax_Size2; vertical-align: 0em;">∏</span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span><span style="position: absolute; clip: rect(3.383em, 1001.11em, 4.274em, -1000em); top: -2.923em; left: 0.06em;"><span class="texatom" id="MathJax-Span-168"><span class="mrow" id="MathJax-Span-169"><span class="mi" id="MathJax-Span-170" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">t</span><span class="mo" id="MathJax-Span-171" style="font-size: 70.7%; font-family: MathJax_Main;">=</span><span class="mn" id="MathJax-Span-172" style="font-size: 70.7%; font-family: MathJax_Main;">1</span></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span><span style="position: absolute; clip: rect(3.275em, 1000.71em, 4.375em, -1000em); top: -5.28em; left: 0.282em;"><span class="texatom" id="MathJax-Span-173"><span class="mrow" id="MathJax-Span-174"><span class="msubsup" id="MathJax-Span-175"><span style="display: inline-block; position: relative; width: 0.714em; height: 0px;"><span style="position: absolute; clip: rect(3.375em, 1000.5em, 4.167em, -1000em); top: -4.01em; left: 0em;"><span class="mi" id="MathJax-Span-176" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">T<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.085em;"></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span><span style="position: absolute; top: -3.904em; left: 0.413em;"><span class="mi" id="MathJax-Span-177" style="font-size: 50%; font-family: MathJax_Math; font-style: italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span></span></span><span class="mi" id="MathJax-Span-178" style="font-family: MathJax_Math; font-style: italic; padding-left: 0.167em;">P<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.109em;"></span></span><span class="mo" id="MathJax-Span-179" style="font-family: MathJax_Main;">(</span><span class="msubsup" id="MathJax-Span-180"><span style="display: inline-block; position: relative; width: 1.978em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.5em, 4.372em, -1000em); top: -4.01em; left: 0em;"><span class="mi" id="MathJax-Span-181" style="font-family: MathJax_Math; font-style: italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.006em;"></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span><span style="position: absolute; top: -4.423em; left: 0.548em;"><span class="texatom" id="MathJax-Span-182"><span class="mrow" id="MathJax-Span-183"><span class="mo" id="MathJax-Span-184" style="font-size: 70.7%; font-family: MathJax_Main;">&lt;</span><span class="mi" id="MathJax-Span-185" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">t</span><span class="mo" id="MathJax-Span-186" style="font-size: 70.7%; font-family: MathJax_Main;">&gt;</span></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span></span></span><span class="texatom" id="MathJax-Span-187"><span class="mrow" id="MathJax-Span-188"><span class="mo" id="MathJax-Span-189" style="font-family: MathJax_Main;">|</span></span></span><span class="mi" id="MathJax-Span-190" style="font-family: MathJax_Math; font-style: italic;">x</span><span class="mo" id="MathJax-Span-191" style="font-family: MathJax_Main;">,</span><span class="msubsup" id="MathJax-Span-192" style="padding-left: 0.167em;"><span style="display: inline-block; position: relative; width: 2.077em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.5em, 4.372em, -1000em); top: -4.01em; left: 0em;"><span class="mi" id="MathJax-Span-193" style="font-family: MathJax_Math; font-style: italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.006em;"></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span><span style="position: absolute; top: -4.423em; left: 0.548em;"><span class="texatom" id="MathJax-Span-194"><span class="mrow" id="MathJax-Span-195"><span class="mo" id="MathJax-Span-196" style="font-size: 70.7%; font-family: MathJax_Main;">&lt;</span><span class="mn" id="MathJax-Span-197" style="font-size: 70.7%; font-family: MathJax_Main;">1</span><span class="mo" id="MathJax-Span-198" style="font-size: 70.7%; font-family: MathJax_Main;">&gt;</span></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span></span></span><span class="mo" id="MathJax-Span-199" style="font-family: MathJax_Main; padding-left: 0.167em;">…</span><span class="msubsup" id="MathJax-Span-200" style="padding-left: 0.167em;"><span style="display: inline-block; position: relative; width: 2.882em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.5em, 4.372em, -1000em); top: -4.01em; left: 0em;"><span class="mi" id="MathJax-Span-201" style="font-family: MathJax_Math; font-style: italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.006em;"></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span><span style="position: absolute; top: -4.423em; left: 0.548em;"><span class="texatom" id="MathJax-Span-202"><span class="mrow" id="MathJax-Span-203"><span class="mo" id="MathJax-Span-204" style="font-size: 70.7%; font-family: MathJax_Main;">&lt;</span><span class="mi" id="MathJax-Span-205" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">t</span><span class="mo" id="MathJax-Span-206" style="font-size: 70.7%; font-family: MathJax_Main;">−</span><span class="mn" id="MathJax-Span-207" style="font-size: 70.7%; font-family: MathJax_Main;">1</span><span class="mo" id="MathJax-Span-208" style="font-size: 70.7%; font-family: MathJax_Main;">&gt;</span></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span></span></span><span class="mo" id="MathJax-Span-209" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-210" style="font-family: MathJax_Main; padding-left: 0.278em;">=</span><span class="mi" id="MathJax-Span-211" style="font-family: MathJax_Math; font-style: italic; padding-left: 0.278em;">P<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.109em;"></span></span><span class="mo" id="MathJax-Span-212" style="font-family: MathJax_Main;">(</span><span class="msubsup" id="MathJax-Span-213"><span style="display: inline-block; position: relative; width: 2.077em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.5em, 4.372em, -1000em); top: -4.01em; left: 0em;"><span class="mi" id="MathJax-Span-214" style="font-family: MathJax_Math; font-style: italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.006em;"></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span><span style="position: absolute; top: -4.423em; left: 0.548em;"><span class="texatom" id="MathJax-Span-215"><span class="mrow" id="MathJax-Span-216"><span class="mo" id="MathJax-Span-217" style="font-size: 70.7%; font-family: MathJax_Main;">&lt;</span><span class="mn" id="MathJax-Span-218" style="font-size: 70.7%; font-family: MathJax_Main;">1</span><span class="mo" id="MathJax-Span-219" style="font-size: 70.7%; font-family: MathJax_Main;">&gt;</span></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span></span></span><span class="texatom" id="MathJax-Span-220"><span class="mrow" id="MathJax-Span-221"><span class="mo" id="MathJax-Span-222" style="font-family: MathJax_Main;">|</span></span></span><span class="mi" id="MathJax-Span-223" style="font-family: MathJax_Math; font-style: italic;">x</span><span class="mo" id="MathJax-Span-224" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-225" style="font-family: MathJax_Main; padding-left: 0.222em;">∗</span><span class="mi" id="MathJax-Span-226" style="font-family: MathJax_Math; font-style: italic; padding-left: 0.222em;">P<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.109em;"></span></span><span class="mo" id="MathJax-Span-227" style="font-family: MathJax_Main;">(</span><span class="msubsup" id="MathJax-Span-228"><span style="display: inline-block; position: relative; width: 2.077em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.5em, 4.372em, -1000em); top: -4.01em; left: 0em;"><span class="mi" id="MathJax-Span-229" style="font-family: MathJax_Math; font-style: italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.006em;"></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span><span style="position: absolute; top: -4.423em; left: 0.548em;"><span class="texatom" id="MathJax-Span-230"><span class="mrow" id="MathJax-Span-231"><span class="mo" id="MathJax-Span-232" style="font-size: 70.7%; font-family: MathJax_Main;">&lt;</span><span class="mn" id="MathJax-Span-233" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span class="mo" id="MathJax-Span-234" style="font-size: 70.7%; font-family: MathJax_Main;">&gt;</span></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span></span></span><span class="texatom" id="MathJax-Span-235"><span class="mrow" id="MathJax-Span-236"><span class="mo" id="MathJax-Span-237" style="font-family: MathJax_Main;">|</span></span></span><span class="mi" id="MathJax-Span-238" style="font-family: MathJax_Math; font-style: italic;">x</span><span class="mo" id="MathJax-Span-239" style="font-family: MathJax_Main;">,</span><span class="msubsup" id="MathJax-Span-240" style="padding-left: 0.167em;"><span style="display: inline-block; position: relative; width: 2.077em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.5em, 4.372em, -1000em); top: -4.01em; left: 0em;"><span class="mi" id="MathJax-Span-241" style="font-family: MathJax_Math; font-style: italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.006em;"></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span><span style="position: absolute; top: -4.423em; left: 0.548em;"><span class="texatom" id="MathJax-Span-242"><span class="mrow" id="MathJax-Span-243"><span class="mo" id="MathJax-Span-244" style="font-size: 70.7%; font-family: MathJax_Main;">&lt;</span><span class="mn" id="MathJax-Span-245" style="font-size: 70.7%; font-family: MathJax_Main;">1</span><span class="mo" id="MathJax-Span-246" style="font-size: 70.7%; font-family: MathJax_Main;">&gt;</span></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span></span></span><span class="mo" id="MathJax-Span-247" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-248" style="font-family: MathJax_Main; padding-left: 0.222em;">∗</span><span style="display: inline-block; width: 0px; height: 4.063em;"></span></span><span style="position: absolute; clip: rect(2.97em, 1012.51em, 4.417em, -1000em); top: -1.501em; left: 50%; margin-left: -6.303em;"><span class="mo" id="MathJax-Span-249" style="font-family: MathJax_Main;">…</span><span class="mi" id="MathJax-Span-250" style="font-family: MathJax_Math; font-style: italic; padding-left: 0.167em;">P<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.109em;"></span></span><span class="mo" id="MathJax-Span-251" style="font-family: MathJax_Main;">(</span><span class="msubsup" id="MathJax-Span-252"><span style="display: inline-block; position: relative; width: 1.978em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.5em, 4.372em, -1000em); top: -4.01em; left: 0em;"><span class="mi" id="MathJax-Span-253" style="font-family: MathJax_Math; font-style: italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.006em;"></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span><span style="position: absolute; top: -4.423em; left: 0.548em;"><span class="texatom" id="MathJax-Span-254"><span class="mrow" id="MathJax-Span-255"><span class="mo" id="MathJax-Span-256" style="font-size: 70.7%; font-family: MathJax_Main;">&lt;</span><span class="mi" id="MathJax-Span-257" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">t</span><span class="mo" id="MathJax-Span-258" style="font-size: 70.7%; font-family: MathJax_Main;">&gt;</span></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span></span></span><span class="texatom" id="MathJax-Span-259"><span class="mrow" id="MathJax-Span-260"><span class="mo" id="MathJax-Span-261" style="font-family: MathJax_Main;">|</span></span></span><span class="mi" id="MathJax-Span-262" style="font-family: MathJax_Math; font-style: italic;">x</span><span class="mo" id="MathJax-Span-263" style="font-family: MathJax_Main;">,</span><span class="msubsup" id="MathJax-Span-264" style="padding-left: 0.167em;"><span style="display: inline-block; position: relative; width: 2.077em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.5em, 4.372em, -1000em); top: -4.01em; left: 0em;"><span class="mi" id="MathJax-Span-265" style="font-family: MathJax_Math; font-style: italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.006em;"></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span><span style="position: absolute; top: -4.423em; left: 0.548em;"><span class="texatom" id="MathJax-Span-266"><span class="mrow" id="MathJax-Span-267"><span class="mo" id="MathJax-Span-268" style="font-size: 70.7%; font-family: MathJax_Main;">&lt;</span><span class="mn" id="MathJax-Span-269" style="font-size: 70.7%; font-family: MathJax_Main;">1</span><span class="mo" id="MathJax-Span-270" style="font-size: 70.7%; font-family: MathJax_Main;">&gt;</span></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span></span></span><span class="mo" id="MathJax-Span-271" style="font-family: MathJax_Main; padding-left: 0.167em;">…</span><span class="msubsup" id="MathJax-Span-272" style="padding-left: 0.167em;"><span style="display: inline-block; position: relative; width: 2.882em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.5em, 4.372em, -1000em); top: -4.01em; left: 0em;"><span class="mi" id="MathJax-Span-273" style="font-family: MathJax_Math; font-style: italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.006em;"></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span><span style="position: absolute; top: -4.423em; left: 0.548em;"><span class="texatom" id="MathJax-Span-274"><span class="mrow" id="MathJax-Span-275"><span class="mo" id="MathJax-Span-276" style="font-size: 70.7%; font-family: MathJax_Main;">&lt;</span><span class="mi" id="MathJax-Span-277" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">t</span><span class="mo" id="MathJax-Span-278" style="font-size: 70.7%; font-family: MathJax_Main;">−</span><span class="mn" id="MathJax-Span-279" style="font-size: 70.7%; font-family: MathJax_Main;">1</span><span class="mo" id="MathJax-Span-280" style="font-size: 70.7%; font-family: MathJax_Main;">&gt;</span></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span></span></span><span class="mo" id="MathJax-Span-281" style="font-family: MathJax_Main;">)</span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 5.625em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -3.374em; border-left: 0px solid; width: 0px; height: 5.655em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><munderover><mo>∏</mo><mrow class="MJX-TeXAtom-ORD"><mi>t</mi><mo>=</mo><mn>1</mn></mrow><mrow class="MJX-TeXAtom-ORD"><msub><mi>T</mi><mi>y</mi></msub></mrow></munderover><mi>P</mi><mo stretchy="false">(</mo><msup><mi>y</mi><mrow class="MJX-TeXAtom-ORD"><mo>&lt;</mo><mi>t</mi><mo>&gt;</mo></mrow></msup><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><mi>x</mi><mo>,</mo><msup><mi>y</mi><mrow class="MJX-TeXAtom-ORD"><mo>&lt;</mo><mn>1</mn><mo>&gt;</mo></mrow></msup><mo>…</mo><msup><mi>y</mi><mrow class="MJX-TeXAtom-ORD"><mo>&lt;</mo><mi>t</mi><mo>−</mo><mn>1</mn><mo>&gt;</mo></mrow></msup><mo stretchy="false">)</mo><mo>=</mo><mi>P</mi><mo stretchy="false">(</mo><msup><mi>y</mi><mrow class="MJX-TeXAtom-ORD"><mo>&lt;</mo><mn>1</mn><mo>&gt;</mo></mrow></msup><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><mi>x</mi><mo stretchy="false">)</mo><mo>∗</mo><mi>P</mi><mo stretchy="false">(</mo><msup><mi>y</mi><mrow class="MJX-TeXAtom-ORD"><mo>&lt;</mo><mn>2</mn><mo>&gt;</mo></mrow></msup><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><mi>x</mi><mo>,</mo><msup><mi>y</mi><mrow class="MJX-TeXAtom-ORD"><mo>&lt;</mo><mn>1</mn><mo>&gt;</mo></mrow></msup><mo stretchy="false">)</mo><mo>∗</mo><mo>…</mo><mi>P</mi><mo stretchy="false">(</mo><msup><mi>y</mi><mrow class="MJX-TeXAtom-ORD"><mo>&lt;</mo><mi>t</mi><mo>&gt;</mo></mrow></msup><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><mi>x</mi><mo>,</mo><msup><mi>y</mi><mrow class="MJX-TeXAtom-ORD"><mo>&lt;</mo><mn>1</mn><mo>&gt;</mo></mrow></msup><mo>…</mo><msup><mi>y</mi><mrow class="MJX-TeXAtom-ORD"><mo>&lt;</mo><mi>t</mi><mo>−</mo><mn>1</mn><mo>&gt;</mo></mrow></msup><mo stretchy="false">)</mo></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-8"> \prod_{t=1}^{T_y}P(y^{<t>}|x, y^{<1>}…y^{<t-1>})=P(y^{<1>}|x)*P(y^{<2>}|x,y^{<1>})*…P(y^{<t>}|x, y^{<1>}…y^{<t-1>})</script> <br>
这样做有两个问题： <br>
1）由于每一个概率P都是小于1的，多个小于1的数相乘，结果会越来越小，有可能小到超出float型的精度而无法表示，所以通常会取log，变成加法： <br>
<span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_Display" style="text-align: center;"></div><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-9-Frame" tabindex="0" style="text-align: center; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mi>a</mi><mi>r</mi><mi>g</mi><munder><mo movablelimits=&quot;true&quot; form=&quot;prefix&quot;>max</mo><mi>y</mi></munder><munderover><mo>&amp;#x2211;</mo><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>t</mi><mo>=</mo><mn>1</mn></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><msub><mi>T</mi><mi>y</mi></msub></mrow></munderover><mi>l</mi><mi>o</mi><mi>g</mi><mo stretchy=&quot;false&quot;>(</mo><mi>P</mi><mo stretchy=&quot;false&quot;>(</mo><msup><mi>y</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;lt;</mo><mi>t</mi><mo>&amp;gt;</mo></mrow></msup><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo stretchy=&quot;false&quot;>|</mo></mrow><mi>x</mi><mo>,</mo><msup><mi>y</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;lt;</mo><mn>1</mn><mo>&amp;gt;</mo></mrow></msup><mo>&amp;#x2026;</mo><msup><mi>y</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;lt;</mo><mi>t</mi><mo>&amp;#x2212;</mo><mn>1</mn><mo>&amp;gt;</mo></mrow></msup><mo stretchy=&quot;false&quot;>)</mo><mo stretchy=&quot;false&quot;>)</mo></math>" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-282" style="width: 22.346em; display: inline-block;"><span style="display: inline-block; position: relative; width: 18.594em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(0.287em, 1018.5em, 3.643em, -1000em); top: -2.292em; left: 0em;"><span class="mrow" id="MathJax-Span-283"><span class="mi" id="MathJax-Span-284" style="font-family: MathJax_Math; font-style: italic;">a</span><span class="mi" id="MathJax-Span-285" style="font-family: MathJax_Math; font-style: italic;">r</span><span class="mi" id="MathJax-Span-286" style="font-family: MathJax_Math; font-style: italic;">g<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="munderover" id="MathJax-Span-287" style="padding-left: 0.167em;"><span style="display: inline-block; position: relative; width: 1.861em; height: 0px;"><span style="position: absolute; clip: rect(3.406em, 1001.85em, 4.178em, -1000em); top: -4.01em; left: 0em;"><span class="mo" id="MathJax-Span-288" style="font-family: MathJax_Main;">max</span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span><span style="position: absolute; clip: rect(3.542em, 1000.35em, 4.412em, -1000em); top: -3.399em; left: 0.755em;"><span class="mi" id="MathJax-Span-289" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.004em;"></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span></span></span><span class="munderover" id="MathJax-Span-290" style="padding-left: 0.167em;"><span style="display: inline-block; position: relative; width: 1.444em; height: 0px;"><span style="position: absolute; clip: rect(2.904em, 1001.39em, 4.617em, -1000em); top: -4.01em; left: 0em;"><span class="mo" id="MathJax-Span-291" style="font-family: MathJax_Size2; vertical-align: 0em;">∑</span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span><span style="position: absolute; clip: rect(3.383em, 1001.11em, 4.274em, -1000em); top: -2.923em; left: 0.143em;"><span class="texatom" id="MathJax-Span-292"><span class="mrow" id="MathJax-Span-293"><span class="mi" id="MathJax-Span-294" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">t</span><span class="mo" id="MathJax-Span-295" style="font-size: 70.7%; font-family: MathJax_Main;">=</span><span class="mn" id="MathJax-Span-296" style="font-size: 70.7%; font-family: MathJax_Main;">1</span></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span><span style="position: absolute; clip: rect(3.275em, 1000.71em, 4.375em, -1000em); top: -5.28em; left: 0.365em;"><span class="texatom" id="MathJax-Span-297"><span class="mrow" id="MathJax-Span-298"><span class="msubsup" id="MathJax-Span-299"><span style="display: inline-block; position: relative; width: 0.714em; height: 0px;"><span style="position: absolute; clip: rect(3.375em, 1000.5em, 4.167em, -1000em); top: -4.01em; left: 0em;"><span class="mi" id="MathJax-Span-300" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">T<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.085em;"></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span><span style="position: absolute; top: -3.904em; left: 0.413em;"><span class="mi" id="MathJax-Span-301" style="font-size: 50%; font-family: MathJax_Math; font-style: italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span></span></span><span class="mi" id="MathJax-Span-302" style="font-family: MathJax_Math; font-style: italic; padding-left: 0.167em;">l</span><span class="mi" id="MathJax-Span-303" style="font-family: MathJax_Math; font-style: italic;">o</span><span class="mi" id="MathJax-Span-304" style="font-family: MathJax_Math; font-style: italic;">g<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-305" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-306" style="font-family: MathJax_Math; font-style: italic;">P<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.109em;"></span></span><span class="mo" id="MathJax-Span-307" style="font-family: MathJax_Main;">(</span><span class="msubsup" id="MathJax-Span-308"><span style="display: inline-block; position: relative; width: 1.978em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.5em, 4.372em, -1000em); top: -4.01em; left: 0em;"><span class="mi" id="MathJax-Span-309" style="font-family: MathJax_Math; font-style: italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.006em;"></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span><span style="position: absolute; top: -4.423em; left: 0.548em;"><span class="texatom" id="MathJax-Span-310"><span class="mrow" id="MathJax-Span-311"><span class="mo" id="MathJax-Span-312" style="font-size: 70.7%; font-family: MathJax_Main;">&lt;</span><span class="mi" id="MathJax-Span-313" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">t</span><span class="mo" id="MathJax-Span-314" style="font-size: 70.7%; font-family: MathJax_Main;">&gt;</span></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span></span></span><span class="texatom" id="MathJax-Span-315"><span class="mrow" id="MathJax-Span-316"><span class="mo" id="MathJax-Span-317" style="font-family: MathJax_Main;">|</span></span></span><span class="mi" id="MathJax-Span-318" style="font-family: MathJax_Math; font-style: italic;">x</span><span class="mo" id="MathJax-Span-319" style="font-family: MathJax_Main;">,</span><span class="msubsup" id="MathJax-Span-320" style="padding-left: 0.167em;"><span style="display: inline-block; position: relative; width: 2.077em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.5em, 4.372em, -1000em); top: -4.01em; left: 0em;"><span class="mi" id="MathJax-Span-321" style="font-family: MathJax_Math; font-style: italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.006em;"></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span><span style="position: absolute; top: -4.423em; left: 0.548em;"><span class="texatom" id="MathJax-Span-322"><span class="mrow" id="MathJax-Span-323"><span class="mo" id="MathJax-Span-324" style="font-size: 70.7%; font-family: MathJax_Main;">&lt;</span><span class="mn" id="MathJax-Span-325" style="font-size: 70.7%; font-family: MathJax_Main;">1</span><span class="mo" id="MathJax-Span-326" style="font-size: 70.7%; font-family: MathJax_Main;">&gt;</span></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span></span></span><span class="mo" id="MathJax-Span-327" style="font-family: MathJax_Main; padding-left: 0.167em;">…</span><span class="msubsup" id="MathJax-Span-328" style="padding-left: 0.167em;"><span style="display: inline-block; position: relative; width: 2.882em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.5em, 4.372em, -1000em); top: -4.01em; left: 0em;"><span class="mi" id="MathJax-Span-329" style="font-family: MathJax_Math; font-style: italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.006em;"></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span><span style="position: absolute; top: -4.423em; left: 0.548em;"><span class="texatom" id="MathJax-Span-330"><span class="mrow" id="MathJax-Span-331"><span class="mo" id="MathJax-Span-332" style="font-size: 70.7%; font-family: MathJax_Main;">&lt;</span><span class="mi" id="MathJax-Span-333" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">t</span><span class="mo" id="MathJax-Span-334" style="font-size: 70.7%; font-family: MathJax_Main;">−</span><span class="mn" id="MathJax-Span-335" style="font-size: 70.7%; font-family: MathJax_Main;">1</span><span class="mo" id="MathJax-Span-336" style="font-size: 70.7%; font-family: MathJax_Main;">&gt;</span></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span></span></span><span class="mo" id="MathJax-Span-337" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-338" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.292em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -1.497em; border-left: 0px solid; width: 0px; height: 3.778em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>a</mi><mi>r</mi><mi>g</mi><munder><mo movablelimits="true" form="prefix">max</mo><mi>y</mi></munder><munderover><mo>∑</mo><mrow class="MJX-TeXAtom-ORD"><mi>t</mi><mo>=</mo><mn>1</mn></mrow><mrow class="MJX-TeXAtom-ORD"><msub><mi>T</mi><mi>y</mi></msub></mrow></munderover><mi>l</mi><mi>o</mi><mi>g</mi><mo stretchy="false">(</mo><mi>P</mi><mo stretchy="false">(</mo><msup><mi>y</mi><mrow class="MJX-TeXAtom-ORD"><mo>&lt;</mo><mi>t</mi><mo>&gt;</mo></mrow></msup><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><mi>x</mi><mo>,</mo><msup><mi>y</mi><mrow class="MJX-TeXAtom-ORD"><mo>&lt;</mo><mn>1</mn><mo>&gt;</mo></mrow></msup><mo>…</mo><msup><mi>y</mi><mrow class="MJX-TeXAtom-ORD"><mo>&lt;</mo><mi>t</mi><mo>−</mo><mn>1</mn><mo>&gt;</mo></mrow></msup><mo stretchy="false">)</mo><mo stretchy="false">)</mo></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-9">arg\max_y\sum_{t=1}^{T_y}log(P(y^{<t>}|x, y^{<1>}…y^{<t-1>}))</script> <br>
2）这样做通常会偏向较短的句子，因为较短的句子词少，因为每个词的概率都是小于1的数，所以乘的数越少那么结果就越大，解决办法就是用长度进行归一化，也就是除以长度： <br>
<span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_Display" style="text-align: center;"></div><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-10-Frame" tabindex="0" style="text-align: center; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mi>a</mi><mi>r</mi><mi>g</mi><munder><mo movablelimits=&quot;true&quot; form=&quot;prefix&quot;>max</mo><mi>y</mi></munder><mfrac><mn>1</mn><msub><mi>T</mi><mi>y</mi></msub></mfrac><munderover><mo>&amp;#x2211;</mo><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>t</mi><mo>=</mo><mn>1</mn></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><msub><mi>T</mi><mi>y</mi></msub></mrow></munderover><mi>l</mi><mi>o</mi><mi>g</mi><mo stretchy=&quot;false&quot;>(</mo><mi>P</mi><mo stretchy=&quot;false&quot;>(</mo><msup><mi>y</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;lt;</mo><mi>t</mi><mo>&amp;gt;</mo></mrow></msup><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo stretchy=&quot;false&quot;>|</mo></mrow><mi>x</mi><mo>,</mo><msup><mi>y</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;lt;</mo><mn>1</mn><mo>&amp;gt;</mo></mrow></msup><mo>&amp;#x2026;</mo><msup><mi>y</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;lt;</mo><mi>t</mi><mo>&amp;#x2212;</mo><mn>1</mn><mo>&amp;gt;</mo></mrow></msup><mo stretchy=&quot;false&quot;>)</mo><mo stretchy=&quot;false&quot;>)</mo></math>" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-339" style="width: 24.169em; display: inline-block;"><span style="display: inline-block; position: relative; width: 20.104em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(0.287em, 1020.01em, 3.643em, -1000em); top: -2.292em; left: 0em;"><span class="mrow" id="MathJax-Span-340"><span class="mi" id="MathJax-Span-341" style="font-family: MathJax_Math; font-style: italic;">a</span><span class="mi" id="MathJax-Span-342" style="font-family: MathJax_Math; font-style: italic;">r</span><span class="mi" id="MathJax-Span-343" style="font-family: MathJax_Math; font-style: italic;">g<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="munderover" id="MathJax-Span-344" style="padding-left: 0.167em;"><span style="display: inline-block; position: relative; width: 1.861em; height: 0px;"><span style="position: absolute; clip: rect(3.406em, 1001.85em, 4.178em, -1000em); top: -4.01em; left: 0em;"><span class="mo" id="MathJax-Span-345" style="font-family: MathJax_Main;">max</span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span><span style="position: absolute; clip: rect(3.542em, 1000.35em, 4.412em, -1000em); top: -3.399em; left: 0.755em;"><span class="mi" id="MathJax-Span-346" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.004em;"></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span></span></span><span class="mfrac" id="MathJax-Span-347" style="padding-left: 0.167em;"><span style="display: inline-block; position: relative; width: 1.13em; height: 0px; margin-right: 0.12em; margin-left: 0.12em;"><span style="position: absolute; clip: rect(3.188em, 1000.43em, 4.167em, -1000em); top: -4.687em; left: 50%; margin-left: -0.25em;"><span class="mn" id="MathJax-Span-348" style="font-family: MathJax_Main;">1</span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span><span style="position: absolute; clip: rect(3.177em, 1001.01em, 4.462em, -1000em); top: -3.324em; left: 50%; margin-left: -0.505em;"><span class="msubsup" id="MathJax-Span-349"><span style="display: inline-block; position: relative; width: 1.01em; height: 0px;"><span style="position: absolute; clip: rect(3.177em, 1000.7em, 4.167em, -1000em); top: -4.01em; left: 0em;"><span class="mi" id="MathJax-Span-350" style="font-family: MathJax_Math; font-style: italic;">T<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.12em;"></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span><span style="position: absolute; top: -3.86em; left: 0.584em;"><span class="mi" id="MathJax-Span-351" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.004em;"></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span><span style="position: absolute; clip: rect(0.82em, 1001.13em, 1.198em, -1000em); top: -1.262em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 1.13em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.042em;"></span></span></span></span><span class="munderover" id="MathJax-Span-352" style="padding-left: 0.167em;"><span style="display: inline-block; position: relative; width: 1.444em; height: 0px;"><span style="position: absolute; clip: rect(2.904em, 1001.39em, 4.617em, -1000em); top: -4.01em; left: 0em;"><span class="mo" id="MathJax-Span-353" style="font-family: MathJax_Size2; vertical-align: 0em;">∑</span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span><span style="position: absolute; clip: rect(3.383em, 1001.11em, 4.274em, -1000em); top: -2.923em; left: 0.143em;"><span class="texatom" id="MathJax-Span-354"><span class="mrow" id="MathJax-Span-355"><span class="mi" id="MathJax-Span-356" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">t</span><span class="mo" id="MathJax-Span-357" style="font-size: 70.7%; font-family: MathJax_Main;">=</span><span class="mn" id="MathJax-Span-358" style="font-size: 70.7%; font-family: MathJax_Main;">1</span></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span><span style="position: absolute; clip: rect(3.275em, 1000.71em, 4.375em, -1000em); top: -5.28em; left: 0.365em;"><span class="texatom" id="MathJax-Span-359"><span class="mrow" id="MathJax-Span-360"><span class="msubsup" id="MathJax-Span-361"><span style="display: inline-block; position: relative; width: 0.714em; height: 0px;"><span style="position: absolute; clip: rect(3.375em, 1000.5em, 4.167em, -1000em); top: -4.01em; left: 0em;"><span class="mi" id="MathJax-Span-362" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">T<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.085em;"></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span><span style="position: absolute; top: -3.904em; left: 0.413em;"><span class="mi" id="MathJax-Span-363" style="font-size: 50%; font-family: MathJax_Math; font-style: italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span></span></span><span class="mi" id="MathJax-Span-364" style="font-family: MathJax_Math; font-style: italic; padding-left: 0.167em;">l</span><span class="mi" id="MathJax-Span-365" style="font-family: MathJax_Math; font-style: italic;">o</span><span class="mi" id="MathJax-Span-366" style="font-family: MathJax_Math; font-style: italic;">g<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-367" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-368" style="font-family: MathJax_Math; font-style: italic;">P<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.109em;"></span></span><span class="mo" id="MathJax-Span-369" style="font-family: MathJax_Main;">(</span><span class="msubsup" id="MathJax-Span-370"><span style="display: inline-block; position: relative; width: 1.978em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.5em, 4.372em, -1000em); top: -4.01em; left: 0em;"><span class="mi" id="MathJax-Span-371" style="font-family: MathJax_Math; font-style: italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.006em;"></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span><span style="position: absolute; top: -4.423em; left: 0.548em;"><span class="texatom" id="MathJax-Span-372"><span class="mrow" id="MathJax-Span-373"><span class="mo" id="MathJax-Span-374" style="font-size: 70.7%; font-family: MathJax_Main;">&lt;</span><span class="mi" id="MathJax-Span-375" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">t</span><span class="mo" id="MathJax-Span-376" style="font-size: 70.7%; font-family: MathJax_Main;">&gt;</span></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span></span></span><span class="texatom" id="MathJax-Span-377"><span class="mrow" id="MathJax-Span-378"><span class="mo" id="MathJax-Span-379" style="font-family: MathJax_Main;">|</span></span></span><span class="mi" id="MathJax-Span-380" style="font-family: MathJax_Math; font-style: italic;">x</span><span class="mo" id="MathJax-Span-381" style="font-family: MathJax_Main;">,</span><span class="msubsup" id="MathJax-Span-382" style="padding-left: 0.167em;"><span style="display: inline-block; position: relative; width: 2.077em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.5em, 4.372em, -1000em); top: -4.01em; left: 0em;"><span class="mi" id="MathJax-Span-383" style="font-family: MathJax_Math; font-style: italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.006em;"></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span><span style="position: absolute; top: -4.423em; left: 0.548em;"><span class="texatom" id="MathJax-Span-384"><span class="mrow" id="MathJax-Span-385"><span class="mo" id="MathJax-Span-386" style="font-size: 70.7%; font-family: MathJax_Main;">&lt;</span><span class="mn" id="MathJax-Span-387" style="font-size: 70.7%; font-family: MathJax_Main;">1</span><span class="mo" id="MathJax-Span-388" style="font-size: 70.7%; font-family: MathJax_Main;">&gt;</span></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span></span></span><span class="mo" id="MathJax-Span-389" style="font-family: MathJax_Main; padding-left: 0.167em;">…</span><span class="msubsup" id="MathJax-Span-390" style="padding-left: 0.167em;"><span style="display: inline-block; position: relative; width: 2.882em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.5em, 4.372em, -1000em); top: -4.01em; left: 0em;"><span class="mi" id="MathJax-Span-391" style="font-family: MathJax_Math; font-style: italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.006em;"></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span><span style="position: absolute; top: -4.423em; left: 0.548em;"><span class="texatom" id="MathJax-Span-392"><span class="mrow" id="MathJax-Span-393"><span class="mo" id="MathJax-Span-394" style="font-size: 70.7%; font-family: MathJax_Main;">&lt;</span><span class="mi" id="MathJax-Span-395" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">t</span><span class="mo" id="MathJax-Span-396" style="font-size: 70.7%; font-family: MathJax_Main;">−</span><span class="mn" id="MathJax-Span-397" style="font-size: 70.7%; font-family: MathJax_Main;">1</span><span class="mo" id="MathJax-Span-398" style="font-size: 70.7%; font-family: MathJax_Main;">&gt;</span></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span></span></span><span class="mo" id="MathJax-Span-399" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-400" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.292em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -1.497em; border-left: 0px solid; width: 0px; height: 3.778em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>a</mi><mi>r</mi><mi>g</mi><munder><mo movablelimits="true" form="prefix">max</mo><mi>y</mi></munder><mfrac><mn>1</mn><msub><mi>T</mi><mi>y</mi></msub></mfrac><munderover><mo>∑</mo><mrow class="MJX-TeXAtom-ORD"><mi>t</mi><mo>=</mo><mn>1</mn></mrow><mrow class="MJX-TeXAtom-ORD"><msub><mi>T</mi><mi>y</mi></msub></mrow></munderover><mi>l</mi><mi>o</mi><mi>g</mi><mo stretchy="false">(</mo><mi>P</mi><mo stretchy="false">(</mo><msup><mi>y</mi><mrow class="MJX-TeXAtom-ORD"><mo>&lt;</mo><mi>t</mi><mo>&gt;</mo></mrow></msup><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><mi>x</mi><mo>,</mo><msup><mi>y</mi><mrow class="MJX-TeXAtom-ORD"><mo>&lt;</mo><mn>1</mn><mo>&gt;</mo></mrow></msup><mo>…</mo><msup><mi>y</mi><mrow class="MJX-TeXAtom-ORD"><mo>&lt;</mo><mi>t</mi><mo>−</mo><mn>1</mn><mo>&gt;</mo></mrow></msup><mo stretchy="false">)</mo><mo stretchy="false">)</mo></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-10">arg\max_y\frac{1}{T_y}\sum_{t=1}^{T_y}log(P(y^{<t>}|x, y^{<1>}…y^{<t-1>}))</script> <br>
在实际工作中有个实验性的做法，就是给长度<span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-11-Frame" tabindex="0" style="position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msub><mi>T</mi><mi>y</mi></msub></math>" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-401" style="width: 1.201em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.99em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.354em, 1000.99em, 2.639em, -1000em); top: -2.188em; left: 0em;"><span class="mrow" id="MathJax-Span-402"><span class="msubsup" id="MathJax-Span-403"><span style="display: inline-block; position: relative; width: 1.01em; height: 0px;"><span style="position: absolute; clip: rect(3.177em, 1000.7em, 4.167em, -1000em); top: -4.01em; left: 0em;"><span class="mi" id="MathJax-Span-404" style="font-family: MathJax_Math; font-style: italic;">T<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.12em;"></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span><span style="position: absolute; top: -3.86em; left: 0.584em;"><span class="mi" id="MathJax-Span-405" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.004em;"></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.188em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.416em; border-left: 0px solid; width: 0px; height: 1.291em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>T</mi><mi>y</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-11">T_y</script>添加一个参数<span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-12-Frame" tabindex="0" style="position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>&amp;#x03B1;</mi></math>" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-406" style="width: 0.784em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.625em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.693em, 1000.59em, 2.459em, -1000em); top: -2.292em; left: 0em;"><span class="mrow" id="MathJax-Span-407"><span class="mi" id="MathJax-Span-408" style="font-family: MathJax_Math; font-style: italic;">α</span></span><span style="display: inline-block; width: 0px; height: 2.292em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.076em; border-left: 0px solid; width: 0px; height: 0.669em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>α</mi></math></span></span><script type="math/tex" id="MathJax-Element-12">\alpha</script>： <br>
<span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_Display" style="text-align: center;"></div><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-13-Frame" tabindex="0" style="text-align: center; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mi>a</mi><mi>r</mi><mi>g</mi><munder><mo movablelimits=&quot;true&quot; form=&quot;prefix&quot;>max</mo><mi>y</mi></munder><mfrac><mn>1</mn><msubsup><mi>T</mi><mi>y</mi><mi>&amp;#x03B1;</mi></msubsup></mfrac><munderover><mo>&amp;#x2211;</mo><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>t</mi><mo>=</mo><mn>1</mn></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><msub><mi>T</mi><mi>y</mi></msub></mrow></munderover><mi>l</mi><mi>o</mi><mi>g</mi><mo stretchy=&quot;false&quot;>(</mo><mi>P</mi><mo stretchy=&quot;false&quot;>(</mo><msup><mi>y</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;lt;</mo><mi>t</mi><mo>&amp;gt;</mo></mrow></msup><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo stretchy=&quot;false&quot;>|</mo></mrow><mi>x</mi><mo>,</mo><msup><mi>y</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;lt;</mo><mn>1</mn><mo>&amp;gt;</mo></mrow></msup><mo>&amp;#x2026;</mo><msup><mi>y</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;lt;</mo><mi>t</mi><mo>&amp;#x2212;</mo><mn>1</mn><mo>&amp;gt;</mo></mrow></msup><mo stretchy=&quot;false&quot;>)</mo><mo stretchy=&quot;false&quot;>)</mo></math>" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-409" style="width: 24.534em; display: inline-block;"><span style="display: inline-block; position: relative; width: 20.417em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(0.287em, 1020.32em, 3.643em, -1000em); top: -2.292em; left: 0em;"><span class="mrow" id="MathJax-Span-410"><span class="mi" id="MathJax-Span-411" style="font-family: MathJax_Math; font-style: italic;">a</span><span class="mi" id="MathJax-Span-412" style="font-family: MathJax_Math; font-style: italic;">r</span><span class="mi" id="MathJax-Span-413" style="font-family: MathJax_Math; font-style: italic;">g<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="munderover" id="MathJax-Span-414" style="padding-left: 0.167em;"><span style="display: inline-block; position: relative; width: 1.861em; height: 0px;"><span style="position: absolute; clip: rect(3.406em, 1001.85em, 4.178em, -1000em); top: -4.01em; left: 0em;"><span class="mo" id="MathJax-Span-415" style="font-family: MathJax_Main;">max</span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span><span style="position: absolute; clip: rect(3.542em, 1000.35em, 4.412em, -1000em); top: -3.399em; left: 0.755em;"><span class="mi" id="MathJax-Span-416" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.004em;"></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span></span></span><span class="mfrac" id="MathJax-Span-417" style="padding-left: 0.167em;"><span style="display: inline-block; position: relative; width: 1.438em; height: 0px; margin-right: 0.12em; margin-left: 0.12em;"><span style="position: absolute; clip: rect(3.188em, 1000.43em, 4.167em, -1000em); top: -4.687em; left: 50%; margin-left: -0.25em;"><span class="mn" id="MathJax-Span-418" style="font-family: MathJax_Main;">1</span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span><span style="position: absolute; clip: rect(3.177em, 1001.32em, 4.46em, -1000em); top: -3.324em; left: 50%; margin-left: -0.659em;"><span class="msubsup" id="MathJax-Span-419"><span style="display: inline-block; position: relative; width: 1.318em; height: 0px;"><span style="position: absolute; clip: rect(3.177em, 1000.7em, 4.167em, -1000em); top: -4.01em; left: 0em;"><span class="mi" id="MathJax-Span-420" style="font-family: MathJax_Math; font-style: italic;">T<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.12em;"></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span><span style="position: absolute; clip: rect(3.542em, 1000.53em, 4.174em, -1000em); top: -4.363em; left: 0.79em;"><span class="mi" id="MathJax-Span-421" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">α</span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span><span style="position: absolute; clip: rect(3.542em, 1000.43em, 4.312em, -1000em); top: -3.862em; left: 0.584em;"><span class="mi" id="MathJax-Span-422" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.004em;"></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span><span style="position: absolute; clip: rect(0.82em, 1001.44em, 1.198em, -1000em); top: -1.262em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 1.438em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.042em;"></span></span></span></span><span class="munderover" id="MathJax-Span-423" style="padding-left: 0.167em;"><span style="display: inline-block; position: relative; width: 1.444em; height: 0px;"><span style="position: absolute; clip: rect(2.904em, 1001.39em, 4.617em, -1000em); top: -4.01em; left: 0em;"><span class="mo" id="MathJax-Span-424" style="font-family: MathJax_Size2; vertical-align: 0em;">∑</span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span><span style="position: absolute; clip: rect(3.383em, 1001.11em, 4.274em, -1000em); top: -2.923em; left: 0.143em;"><span class="texatom" id="MathJax-Span-425"><span class="mrow" id="MathJax-Span-426"><span class="mi" id="MathJax-Span-427" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">t</span><span class="mo" id="MathJax-Span-428" style="font-size: 70.7%; font-family: MathJax_Main;">=</span><span class="mn" id="MathJax-Span-429" style="font-size: 70.7%; font-family: MathJax_Main;">1</span></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span><span style="position: absolute; clip: rect(3.275em, 1000.71em, 4.375em, -1000em); top: -5.28em; left: 0.365em;"><span class="texatom" id="MathJax-Span-430"><span class="mrow" id="MathJax-Span-431"><span class="msubsup" id="MathJax-Span-432"><span style="display: inline-block; position: relative; width: 0.714em; height: 0px;"><span style="position: absolute; clip: rect(3.375em, 1000.5em, 4.167em, -1000em); top: -4.01em; left: 0em;"><span class="mi" id="MathJax-Span-433" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">T<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.085em;"></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span><span style="position: absolute; top: -3.904em; left: 0.413em;"><span class="mi" id="MathJax-Span-434" style="font-size: 50%; font-family: MathJax_Math; font-style: italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span></span></span><span class="mi" id="MathJax-Span-435" style="font-family: MathJax_Math; font-style: italic; padding-left: 0.167em;">l</span><span class="mi" id="MathJax-Span-436" style="font-family: MathJax_Math; font-style: italic;">o</span><span class="mi" id="MathJax-Span-437" style="font-family: MathJax_Math; font-style: italic;">g<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-438" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-439" style="font-family: MathJax_Math; font-style: italic;">P<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.109em;"></span></span><span class="mo" id="MathJax-Span-440" style="font-family: MathJax_Main;">(</span><span class="msubsup" id="MathJax-Span-441"><span style="display: inline-block; position: relative; width: 1.978em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.5em, 4.372em, -1000em); top: -4.01em; left: 0em;"><span class="mi" id="MathJax-Span-442" style="font-family: MathJax_Math; font-style: italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.006em;"></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span><span style="position: absolute; top: -4.423em; left: 0.548em;"><span class="texatom" id="MathJax-Span-443"><span class="mrow" id="MathJax-Span-444"><span class="mo" id="MathJax-Span-445" style="font-size: 70.7%; font-family: MathJax_Main;">&lt;</span><span class="mi" id="MathJax-Span-446" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">t</span><span class="mo" id="MathJax-Span-447" style="font-size: 70.7%; font-family: MathJax_Main;">&gt;</span></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span></span></span><span class="texatom" id="MathJax-Span-448"><span class="mrow" id="MathJax-Span-449"><span class="mo" id="MathJax-Span-450" style="font-family: MathJax_Main;">|</span></span></span><span class="mi" id="MathJax-Span-451" style="font-family: MathJax_Math; font-style: italic;">x</span><span class="mo" id="MathJax-Span-452" style="font-family: MathJax_Main;">,</span><span class="msubsup" id="MathJax-Span-453" style="padding-left: 0.167em;"><span style="display: inline-block; position: relative; width: 2.077em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.5em, 4.372em, -1000em); top: -4.01em; left: 0em;"><span class="mi" id="MathJax-Span-454" style="font-family: MathJax_Math; font-style: italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.006em;"></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span><span style="position: absolute; top: -4.423em; left: 0.548em;"><span class="texatom" id="MathJax-Span-455"><span class="mrow" id="MathJax-Span-456"><span class="mo" id="MathJax-Span-457" style="font-size: 70.7%; font-family: MathJax_Main;">&lt;</span><span class="mn" id="MathJax-Span-458" style="font-size: 70.7%; font-family: MathJax_Main;">1</span><span class="mo" id="MathJax-Span-459" style="font-size: 70.7%; font-family: MathJax_Main;">&gt;</span></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span></span></span><span class="mo" id="MathJax-Span-460" style="font-family: MathJax_Main; padding-left: 0.167em;">…</span><span class="msubsup" id="MathJax-Span-461" style="padding-left: 0.167em;"><span style="display: inline-block; position: relative; width: 2.882em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.5em, 4.372em, -1000em); top: -4.01em; left: 0em;"><span class="mi" id="MathJax-Span-462" style="font-family: MathJax_Math; font-style: italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.006em;"></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span><span style="position: absolute; top: -4.423em; left: 0.548em;"><span class="texatom" id="MathJax-Span-463"><span class="mrow" id="MathJax-Span-464"><span class="mo" id="MathJax-Span-465" style="font-size: 70.7%; font-family: MathJax_Main;">&lt;</span><span class="mi" id="MathJax-Span-466" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">t</span><span class="mo" id="MathJax-Span-467" style="font-size: 70.7%; font-family: MathJax_Main;">−</span><span class="mn" id="MathJax-Span-468" style="font-size: 70.7%; font-family: MathJax_Main;">1</span><span class="mo" id="MathJax-Span-469" style="font-size: 70.7%; font-family: MathJax_Main;">&gt;</span></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span></span></span><span class="mo" id="MathJax-Span-470" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-471" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.292em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -1.497em; border-left: 0px solid; width: 0px; height: 3.778em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>a</mi><mi>r</mi><mi>g</mi><munder><mo movablelimits="true" form="prefix">max</mo><mi>y</mi></munder><mfrac><mn>1</mn><msubsup><mi>T</mi><mi>y</mi><mi>α</mi></msubsup></mfrac><munderover><mo>∑</mo><mrow class="MJX-TeXAtom-ORD"><mi>t</mi><mo>=</mo><mn>1</mn></mrow><mrow class="MJX-TeXAtom-ORD"><msub><mi>T</mi><mi>y</mi></msub></mrow></munderover><mi>l</mi><mi>o</mi><mi>g</mi><mo stretchy="false">(</mo><mi>P</mi><mo stretchy="false">(</mo><msup><mi>y</mi><mrow class="MJX-TeXAtom-ORD"><mo>&lt;</mo><mi>t</mi><mo>&gt;</mo></mrow></msup><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><mi>x</mi><mo>,</mo><msup><mi>y</mi><mrow class="MJX-TeXAtom-ORD"><mo>&lt;</mo><mn>1</mn><mo>&gt;</mo></mrow></msup><mo>…</mo><msup><mi>y</mi><mrow class="MJX-TeXAtom-ORD"><mo>&lt;</mo><mi>t</mi><mo>−</mo><mn>1</mn><mo>&gt;</mo></mrow></msup><mo stretchy="false">)</mo><mo stretchy="false">)</mo></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-13">arg\max_y\frac{1}{T_y^\alpha}\sum_{t=1}^{T_y}log(P(y^{<t>}|x, y^{<1>}…y^{<t-1>}))</script> <br>
通常<span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-14-Frame" tabindex="0" style="position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>&amp;#x03B1;</mi><mo>=</mo><mn>0.7</mn></math>" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-472" style="width: 3.909em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.229em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.459em, 1003.21em, 2.47em, -1000em); top: -2.292em; left: 0em;"><span class="mrow" id="MathJax-Span-473"><span class="mi" id="MathJax-Span-474" style="font-family: MathJax_Math; font-style: italic;">α</span><span class="mo" id="MathJax-Span-475" style="font-family: MathJax_Main; padding-left: 0.278em;">=</span><span class="mn" id="MathJax-Span-476" style="font-family: MathJax_Main; padding-left: 0.278em;">0.7</span></span><span style="display: inline-block; width: 0px; height: 2.292em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.089em; border-left: 0px solid; width: 0px; height: 0.963em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>α</mi><mo>=</mo><mn>0.7</mn></math></span></span><script type="math/tex" id="MathJax-Element-14">\alpha=0.7</script>，虽然这样所并没有什么理论依据，但是这样做表现确实很好，有时候这个函数也叫做归一化的对数似然目标函数。<p></p>



<h4 id="如何选择集束宽b">如何选择集束宽B</h4>

<p>理论上B越大越好，但是B越大，计算代价也越高，对于产品系统来说通常B=10，对于学术研究来说B有可能取1000甚至更大的数。</p>

<p>总结：Beam search不像广度优先搜索BFS或深度优先搜索DFS等精确的搜索算法，它运算速度更快，但是不保证能找到最优结果。</p>



<h1 id="5-定向搜索的误差分析"><a name="t4"></a>5 定向搜索的误差分析</h1>

<p><img src="https://img-blog.csdn.net/20180325123522339?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MTA0MzI0MA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述" title=""> <br>
如图，人类翻译为理想结果，算法翻译跟人类翻译差异较大，这时候需要分析是RNN还是Beam搜索导致的这个问题，解决办法就是计算两个句子的概率： <br>
    -若人类翻译的概率大于算法翻译的概率，那么也就是Beam搜索并没有为我们找到最优的条件概率最大值，问题就在搜索算法； <br>
    -若人类翻译的概率小于等于算法翻译的概率，那么搜索算法没问题，就应该是RNN的问题。 <br>
以上是对单个例子来说的，但通常我们并不根据单个例子的结果采取行动，而是对多个误差样本进行分析，决定主因是谁，再采取行动。 <br>
<img src="https://img-blog.csdn.net/20180325124031548?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MTA0MzI0MA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述" title=""> <br>
如图是对多个误差样本分析的表格，At fault一列是原因，B代表Beam搜索算法，R代表RNN，通过这样的分析来定位主因。</p>



<h1 id="6-bleu-scorebilingual-evaluation-understudy双语评估替补"><a name="t5"></a>6. Bleu score（Bilingual evaluation understudy）双语评估替补</h1>

<p>作用：评估文本生成系统的单一实数评估指标，如机器翻译系统、图像描述系统等 <br>
具体做法，以机器翻译为例，给定一个或多个参考，一个机器翻译结果，然后逐词元的求机器翻译结果和给定参考的匹配概率，如先求一元词的匹配概率P1： <br>
<img src="https://img-blog.csdn.net/20180325175457411?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MTA0MzI0MA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述" title=""> <br>
机器翻译句子是：The cat sat on the mat，找到这句话中所有在参考语句中出现的一元词在整句话中的占比，The cat on the mat这5个一元词都在参考语句中出现了，sat没有，所以匹配概率是 5/6。 <br>
但是这里有个问题那就是如果翻译句子是： the the the the the the the，显然这句翻译很不好，但这句话的一元词匹配概率却是P1=7/7，显然这是不合理的，所以定义一下有效词，也就是即使一个词出现在参考语句中，其有效个数不能超过其在参考语句中出现的次数，如上面的例子，the在参考语句1中出现了1词那么相对参考语句1其一元词匹配概率就是P1=1/7，换一句再试试，比如the cat the cat on the mat, the cat都出现了两次，但是在参考语句中只出现了一次，所以多出来的那次就是无效的，其匹配概率为P1=5/7。 <br>
到这里是计算了一元词的匹配概率，下面计算二元词的匹配概率P2： <br>
<img src="https://img-blog.csdn.net/20180325181740745?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MTA0MzI0MA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述" title=""> <br>
如图，机器翻译的二元词有5组，其中有三组在人工翻译中出现了，那么其匹配概率就是P2=3/5; <br>
同理可以算三元词、四元词等n元词。 <br>
计算出来之后，求均值，在这里为了防止短句子得分过高的情况，比如：The cat，其P1=P2=1，所以均值也是1，这是不合理的，所以这里增加一个参数BP惩罚因子，所以最终的计算公式为： <br>
<span class="MathJax_Preview" style="color: inherit; display: none;"></span></p><div class="MathJax_Display" style="text-align: center;"></div><span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-15-Frame" tabindex="0" style="text-align: center; position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;><mi>B</mi><mi>P</mi><mo>&amp;#x2217;</mo><mi>e</mi><mi>x</mi><mi>p</mi><mo stretchy=&quot;false&quot;>(</mo><mfrac><mn>1</mn><mi>N</mi></mfrac><munderover><mo>&amp;#x2211;</mo><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>n</mi><mo>=</mo><mn>1</mn></mrow><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mi>N</mi></mrow></munderover><msub><mi>P</mi><mi>n</mi></msub><mo stretchy=&quot;false&quot;>)</mo></math>" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-477" style="width: 10.784em; display: inline-block;"><span style="display: inline-block; position: relative; width: 8.958em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(0.402em, 1008.86em, 3.643em, -1000em); top: -2.292em; left: 0em;"><span class="mrow" id="MathJax-Span-478"><span class="mi" id="MathJax-Span-479" style="font-family: MathJax_Math; font-style: italic;">B</span><span class="mi" id="MathJax-Span-480" style="font-family: MathJax_Math; font-style: italic;">P<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.109em;"></span></span><span class="mo" id="MathJax-Span-481" style="font-family: MathJax_Main; padding-left: 0.222em;">∗</span><span class="mi" id="MathJax-Span-482" style="font-family: MathJax_Math; font-style: italic; padding-left: 0.222em;">e</span><span class="mi" id="MathJax-Span-483" style="font-family: MathJax_Math; font-style: italic;">x</span><span class="mi" id="MathJax-Span-484" style="font-family: MathJax_Math; font-style: italic;">p</span><span class="mo" id="MathJax-Span-485" style="font-family: MathJax_Main;">(</span><span class="mfrac" id="MathJax-Span-486"><span style="display: inline-block; position: relative; width: 1.008em; height: 0px; margin-right: 0.12em; margin-left: 0.12em;"><span style="position: absolute; clip: rect(3.188em, 1000.43em, 4.167em, -1000em); top: -4.687em; left: 50%; margin-left: -0.25em;"><span class="mn" id="MathJax-Span-487" style="font-family: MathJax_Main;">1</span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span><span style="position: absolute; clip: rect(3.171em, 1000.89em, 4.167em, -1000em); top: -3.324em; left: 50%; margin-left: -0.444em;"><span class="mi" id="MathJax-Span-488" style="font-family: MathJax_Math; font-style: italic;">N<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.085em;"></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span><span style="position: absolute; clip: rect(0.82em, 1001.01em, 1.198em, -1000em); top: -1.262em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 1.008em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.042em;"></span></span></span></span><span class="munderover" id="MathJax-Span-489" style="padding-left: 0.167em;"><span style="display: inline-block; position: relative; width: 1.444em; height: 0px;"><span style="position: absolute; clip: rect(2.904em, 1001.39em, 4.617em, -1000em); top: -4.01em; left: 0em;"><span class="mo" id="MathJax-Span-490" style="font-family: MathJax_Size2; vertical-align: 0em;">∑</span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span><span style="position: absolute; clip: rect(3.383em, 1001.28em, 4.274em, -1000em); top: -2.923em; left: 0.058em;"><span class="texatom" id="MathJax-Span-491"><span class="mrow" id="MathJax-Span-492"><span class="mi" id="MathJax-Span-493" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">n</span><span class="mo" id="MathJax-Span-494" style="font-size: 70.7%; font-family: MathJax_Main;">=</span><span class="mn" id="MathJax-Span-495" style="font-size: 70.7%; font-family: MathJax_Main;">1</span></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span><span style="position: absolute; clip: rect(3.271em, 1000.63em, 4.167em, -1000em); top: -5.16em; left: 0.408em;"><span class="texatom" id="MathJax-Span-496"><span class="mrow" id="MathJax-Span-497"><span class="mi" id="MathJax-Span-498" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">N<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.06em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-499" style="padding-left: 0.167em;"><span style="display: inline-block; position: relative; width: 1.141em; height: 0px;"><span style="position: absolute; clip: rect(3.171em, 1000.75em, 4.167em, -1000em); top: -4.01em; left: 0em;"><span class="mi" id="MathJax-Span-500" style="font-family: MathJax_Math; font-style: italic;">P<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.109em;"></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span><span style="position: absolute; top: -3.86em; left: 0.642em;"><span class="mi" id="MathJax-Span-501" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">n</span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span></span></span><span class="mo" id="MathJax-Span-502" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.292em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -1.497em; border-left: 0px solid; width: 0px; height: 3.639em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>B</mi><mi>P</mi><mo>∗</mo><mi>e</mi><mi>x</mi><mi>p</mi><mo stretchy="false">(</mo><mfrac><mn>1</mn><mi>N</mi></mfrac><munderover><mo>∑</mo><mrow class="MJX-TeXAtom-ORD"><mi>n</mi><mo>=</mo><mn>1</mn></mrow><mrow class="MJX-TeXAtom-ORD"><mi>N</mi></mrow></munderover><msub><mi>P</mi><mi>n</mi></msub><mo stretchy="false">)</mo></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-15">BP*exp(\frac{1}{N}\sum_{n=1}^{N}P_n)</script> <br>
其中N为最高次元组，BP的取值见下图： <br>
<img src="https://img-blog.csdn.net/20180325192048182?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MTA0MzI0MA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述" title=""><p></p>

<p>在实现过程中通常有封装好的函数，不需要自己实现。 <br>
 具体参考博文<a href="https://blog.csdn.net/wwj_748/article/details/79686042" target="_blank">https://blog.csdn.net/wwj_748/article/details/79686042</a></p>



<h1 id="7-attention-model注意力机制"><a name="t6"></a>7. Attention model注意力机制</h1>

<p>对于很长的句子，人工翻译的时候一般是一部分一部分的翻译，所以我们也希望RNN不要记忆太长的东西，而像人类一样一部分一部分的翻译，这样就引出了注意力机制，帮助决定将注意力放在多长的上下文上。 <br>
<img src="https://img-blog.csdn.net/20180325201627888?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MTA0MzI0MA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述" title=""> <br>
以法语翻译为英语为例，使用双向RNN，但是并不直接生成英语词y，而是将decoder部分增加一个注意力参数<span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-16-Frame" tabindex="0" style="position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>&amp;#x03B1;</mi></math>" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-503" style="width: 0.784em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.625em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.693em, 1000.59em, 2.459em, -1000em); top: -2.292em; left: 0em;"><span class="mrow" id="MathJax-Span-504"><span class="mi" id="MathJax-Span-505" style="font-family: MathJax_Math; font-style: italic;">α</span></span><span style="display: inline-block; width: 0px; height: 2.292em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.076em; border-left: 0px solid; width: 0px; height: 0.669em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>α</mi></math></span></span><script type="math/tex" id="MathJax-Element-16">\alpha</script>然后输入到一个新的RNN层，称之为S，比如<span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-17-Frame" tabindex="0" style="position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msup><mi>&amp;#x03B1;</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;lt;</mo><mn>1</mn><mo>,</mo><mn>1</mn><mo>&amp;gt;</mo></mrow></msup></math>" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-506" style="width: 3.284em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.708em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.197em, 1002.71em, 2.355em, -1000em); top: -2.188em; left: 0em;"><span class="mrow" id="MathJax-Span-507"><span class="msubsup" id="MathJax-Span-508"><span style="display: inline-block; position: relative; width: 2.719em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.6em, 4.178em, -1000em); top: -4.01em; left: 0em;"><span class="mi" id="MathJax-Span-509" style="font-family: MathJax_Math; font-style: italic;">α</span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span><span style="position: absolute; top: -4.373em; left: 0.64em;"><span class="texatom" id="MathJax-Span-510"><span class="mrow" id="MathJax-Span-511"><span class="mo" id="MathJax-Span-512" style="font-size: 70.7%; font-family: MathJax_Main;">&lt;</span><span class="mn" id="MathJax-Span-513" style="font-size: 70.7%; font-family: MathJax_Main;">1</span><span class="mo" id="MathJax-Span-514" style="font-size: 70.7%; font-family: MathJax_Main;">,</span><span class="mn" id="MathJax-Span-515" style="font-size: 70.7%; font-family: MathJax_Main;">1</span><span class="mo" id="MathJax-Span-516" style="font-size: 70.7%; font-family: MathJax_Main;">&gt;</span></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.188em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.076em; border-left: 0px solid; width: 0px; height: 1.139em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mi>α</mi><mrow class="MJX-TeXAtom-ORD"><mo>&lt;</mo><mn>1</mn><mo>,</mo><mn>1</mn><mo>&gt;</mo></mrow></msup></math></span></span><script type="math/tex" id="MathJax-Element-17">\alpha^{<1,1>}</script>表示生成第一个词的时候应该放多少注意力在第一个法语单词上，<span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-18-Frame" tabindex="0" style="position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msup><mi>&amp;#x03B1;</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;lt;</mo><mn>1</mn><mo>,</mo><mn>2</mn><mo>&amp;gt;</mo></mrow></msup></math>" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-517" style="width: 3.284em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.708em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.197em, 1002.71em, 2.355em, -1000em); top: -2.188em; left: 0em;"><span class="mrow" id="MathJax-Span-518"><span class="msubsup" id="MathJax-Span-519"><span style="display: inline-block; position: relative; width: 2.719em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.6em, 4.178em, -1000em); top: -4.01em; left: 0em;"><span class="mi" id="MathJax-Span-520" style="font-family: MathJax_Math; font-style: italic;">α</span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span><span style="position: absolute; top: -4.373em; left: 0.64em;"><span class="texatom" id="MathJax-Span-521"><span class="mrow" id="MathJax-Span-522"><span class="mo" id="MathJax-Span-523" style="font-size: 70.7%; font-family: MathJax_Main;">&lt;</span><span class="mn" id="MathJax-Span-524" style="font-size: 70.7%; font-family: MathJax_Main;">1</span><span class="mo" id="MathJax-Span-525" style="font-size: 70.7%; font-family: MathJax_Main;">,</span><span class="mn" id="MathJax-Span-526" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span class="mo" id="MathJax-Span-527" style="font-size: 70.7%; font-family: MathJax_Main;">&gt;</span></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.188em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.076em; border-left: 0px solid; width: 0px; height: 1.139em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mi>α</mi><mrow class="MJX-TeXAtom-ORD"><mo>&lt;</mo><mn>1</mn><mo>,</mo><mn>2</mn><mo>&gt;</mo></mrow></msup></math></span></span><script type="math/tex" id="MathJax-Element-18">\alpha^{<1,2>}</script>表示生成第一个词的时候应该放多少注意力在第二个法语单词上，然后再由S层生成英语。下一节讲细节。</p>



<h1 id="8-注意力机制的细节"><a name="t7"></a>8 注意力机制的细节</h1>

<p><img src="https://img-blog.csdn.net/20180326112240384?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MTA0MzI0MA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述" title=""> <br>
将法语单词逐个输入到RNN之后，计算前向传播和后向传播的激活值，然后用激活值乘以注意力参数，组合成context，context输入隐藏层S。 <br>
<span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-19-Frame" tabindex="0" style="position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msup><mi>a</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;lt;</mo><msup><mi>t</mi><mo>&amp;#x2032;</mo></msup><mo>&amp;gt;</mo></mrow></msup></math>" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-528" style="width: 2.607em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.135em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.132em, 1002.14em, 2.354em, -1000em); top: -2.188em; left: 0em;"><span class="mrow" id="MathJax-Span-529"><span class="msubsup" id="MathJax-Span-530"><span style="display: inline-block; position: relative; width: 2.15em; height: 0px;"><span style="position: absolute; clip: rect(3.413em, 1000.51em, 4.177em, -1000em); top: -4.01em; left: 0em;"><span class="mi" id="MathJax-Span-531" style="font-family: MathJax_Math; font-style: italic;">a</span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span><span style="position: absolute; top: -4.373em; left: 0.529em;"><span class="texatom" id="MathJax-Span-532"><span class="mrow" id="MathJax-Span-533"><span class="mo" id="MathJax-Span-534" style="font-size: 70.7%; font-family: MathJax_Main;">&lt;</span><span class="msup" id="MathJax-Span-535"><span style="display: inline-block; position: relative; width: 0.446em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.23em, 4.174em, -1000em); top: -4.01em; left: 0em;"><span class="mi" id="MathJax-Span-536" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">t</span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span><span style="position: absolute; top: -4.267em; left: 0.255em;"><span class="mo" id="MathJax-Span-537" style="font-size: 50%; font-family: MathJax_Main;">′</span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span></span></span><span class="mo" id="MathJax-Span-538" style="font-size: 70.7%; font-family: MathJax_Main;">&gt;</span></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.188em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.074em; border-left: 0px solid; width: 0px; height: 1.216em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mi>a</mi><mrow class="MJX-TeXAtom-ORD"><mo>&lt;</mo><msup><mi>t</mi><mo>′</mo></msup><mo>&gt;</mo></mrow></msup></math></span></span><script type="math/tex" id="MathJax-Element-19">a^{<t'>}</script>：表示输入法语单词的激活值（包括前向和后向） <br>
<span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-20-Frame" tabindex="0" style="position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msup><mi>&amp;#x03B1;</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;lt;</mo><mi>t</mi><mo>,</mo><msup><mi>t</mi><mo>&amp;#x2032;</mo></msup><mo>&amp;gt;</mo></mrow></msup></math>" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-539" style="width: 3.284em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.708em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.132em, 1002.71em, 2.355em, -1000em); top: -2.188em; left: 0em;"><span class="mrow" id="MathJax-Span-540"><span class="msubsup" id="MathJax-Span-541"><span style="display: inline-block; position: relative; width: 2.713em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.6em, 4.178em, -1000em); top: -4.01em; left: 0em;"><span class="mi" id="MathJax-Span-542" style="font-family: MathJax_Math; font-style: italic;">α</span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span><span style="position: absolute; top: -4.373em; left: 0.64em;"><span class="texatom" id="MathJax-Span-543"><span class="mrow" id="MathJax-Span-544"><span class="mo" id="MathJax-Span-545" style="font-size: 70.7%; font-family: MathJax_Main;">&lt;</span><span class="mi" id="MathJax-Span-546" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">t</span><span class="mo" id="MathJax-Span-547" style="font-size: 70.7%; font-family: MathJax_Main;">,</span><span class="msup" id="MathJax-Span-548"><span style="display: inline-block; position: relative; width: 0.446em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.23em, 4.174em, -1000em); top: -4.01em; left: 0em;"><span class="mi" id="MathJax-Span-549" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">t</span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span><span style="position: absolute; top: -4.267em; left: 0.255em;"><span class="mo" id="MathJax-Span-550" style="font-size: 50%; font-family: MathJax_Main;">′</span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span></span></span><span class="mo" id="MathJax-Span-551" style="font-size: 70.7%; font-family: MathJax_Main;">&gt;</span></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.188em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.076em; border-left: 0px solid; width: 0px; height: 1.218em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mi>α</mi><mrow class="MJX-TeXAtom-ORD"><mo>&lt;</mo><mi>t</mi><mo>,</mo><msup><mi>t</mi><mo>′</mo></msup><mo>&gt;</mo></mrow></msup></math></span></span><script type="math/tex" id="MathJax-Element-20">\alpha^{<t,t'>}</script>：注意力参数，表示对于输出英语单词t应该放多少注意力在输入法语单词t’上，注意对于任意一个输出来说，其所有的注意力参数之和应该为1，即对于第t个输出单词来说<span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-21-Frame" tabindex="0" style="position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><munder><mo>&amp;#x2211;</mo><mrow class=&quot;MJX-TeXAtom-ORD&quot;><msup><mi>t</mi><mo>&amp;#x2032;</mo></msup></mrow></munder><msup><mi>&amp;#x03B1;</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;lt;</mo><mi>t</mi><mo>,</mo><msup><mi>t</mi><mo>&amp;#x2032;</mo></msup><mo>&amp;gt;</mo></mrow></msup><mo>=</mo><mn>1</mn></math>" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-552" style="width: 7.607em; display: inline-block;"><span style="display: inline-block; position: relative; width: 6.302em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.184em, 1006.23em, 2.689em, -1000em); top: -2.24em; left: 0em;"><span class="mrow" id="MathJax-Span-553"><span class="munderover" id="MathJax-Span-554"><span style="display: inline-block; position: relative; width: 1.577em; height: 0px;"><span style="position: absolute; clip: rect(3.104em, 1001em, 4.417em, -1000em); top: -4.01em; left: 0em;"><span class="mo" id="MathJax-Span-555" style="font-family: MathJax_Size1; vertical-align: 0em;">∑</span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span><span style="position: absolute; top: -3.725em; left: 1.056em;"><span class="texatom" id="MathJax-Span-556"><span class="mrow" id="MathJax-Span-557"><span class="msup" id="MathJax-Span-558"><span style="display: inline-block; position: relative; width: 0.446em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.23em, 4.174em, -1000em); top: -4.01em; left: 0em;"><span class="mi" id="MathJax-Span-559" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">t</span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span><span style="position: absolute; top: -4.267em; left: 0.255em;"><span class="mo" id="MathJax-Span-560" style="font-size: 50%; font-family: MathJax_Main;">′</span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-561" style="padding-left: 0.167em;"><span style="display: inline-block; position: relative; width: 2.713em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.6em, 4.178em, -1000em); top: -4.01em; left: 0em;"><span class="mi" id="MathJax-Span-562" style="font-family: MathJax_Math; font-style: italic;">α</span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span><span style="position: absolute; top: -4.373em; left: 0.64em;"><span class="texatom" id="MathJax-Span-563"><span class="mrow" id="MathJax-Span-564"><span class="mo" id="MathJax-Span-565" style="font-size: 70.7%; font-family: MathJax_Main;">&lt;</span><span class="mi" id="MathJax-Span-566" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">t</span><span class="mo" id="MathJax-Span-567" style="font-size: 70.7%; font-family: MathJax_Main;">,</span><span class="msup" id="MathJax-Span-568"><span style="display: inline-block; position: relative; width: 0.446em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.23em, 4.174em, -1000em); top: -4.01em; left: 0em;"><span class="mi" id="MathJax-Span-569" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">t</span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span><span style="position: absolute; top: -4.267em; left: 0.255em;"><span class="mo" id="MathJax-Span-570" style="font-size: 50%; font-family: MathJax_Main;">′</span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span></span></span><span class="mo" id="MathJax-Span-571" style="font-size: 70.7%; font-family: MathJax_Main;">&gt;</span></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span></span></span><span class="mo" id="MathJax-Span-572" style="font-family: MathJax_Main; padding-left: 0.278em;">=</span><span class="mn" id="MathJax-Span-573" style="font-family: MathJax_Main; padding-left: 0.278em;">1</span></span><span style="display: inline-block; width: 0px; height: 2.24em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.414em; border-left: 0px solid; width: 0px; height: 1.556em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><munder><mo>∑</mo><mrow class="MJX-TeXAtom-ORD"><msup><mi>t</mi><mo>′</mo></msup></mrow></munder><msup><mi>α</mi><mrow class="MJX-TeXAtom-ORD"><mo>&lt;</mo><mi>t</mi><mo>,</mo><msup><mi>t</mi><mo>′</mo></msup><mo>&gt;</mo></mrow></msup><mo>=</mo><mn>1</mn></math></span></span><script type="math/tex" id="MathJax-Element-21">\sum_{t'}\alpha^{<t,t'>}=1</script> <br>
C：context，对于第t个单词来说其上下文环境<span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-22-Frame" tabindex="0" style="position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msup><mi>C</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;lt;</mo><mi>t</mi><mo>&amp;gt;</mo></mrow></msup><mo>=</mo><munder><mo>&amp;#x2211;</mo><mrow class=&quot;MJX-TeXAtom-ORD&quot;><msup><mi>t</mi><mo>&amp;#x2032;</mo></msup></mrow></munder><msup><mi>&amp;#x03B1;</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;lt;</mo><mi>t</mi><mo>,</mo><msup><mi>t</mi><mo>&amp;#x2032;</mo></msup><mo>&amp;gt;</mo></mrow></msup><mo>&amp;#x2217;</mo><msup><mi>a</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;lt;</mo><msup><mi>t</mi><mo>&amp;#x2032;</mo></msup><mo>&amp;gt;</mo></mrow></msup></math>" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-574" style="width: 13.388em; display: inline-block;"><span style="display: inline-block; position: relative; width: 11.146em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.184em, 1011.15em, 2.689em, -1000em); top: -2.24em; left: 0em;"><span class="mrow" id="MathJax-Span-575"><span class="msubsup" id="MathJax-Span-576"><span style="display: inline-block; position: relative; width: 2.254em; height: 0px;"><span style="position: absolute; clip: rect(3.149em, 1000.76em, 4.189em, -1000em); top: -4.01em; left: 0em;"><span class="mi" id="MathJax-Span-577" style="font-family: MathJax_Math; font-style: italic;">C<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.045em;"></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span><span style="position: absolute; top: -4.373em; left: 0.824em;"><span class="texatom" id="MathJax-Span-578"><span class="mrow" id="MathJax-Span-579"><span class="mo" id="MathJax-Span-580" style="font-size: 70.7%; font-family: MathJax_Main;">&lt;</span><span class="mi" id="MathJax-Span-581" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">t</span><span class="mo" id="MathJax-Span-582" style="font-size: 70.7%; font-family: MathJax_Main;">&gt;</span></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span></span></span><span class="mo" id="MathJax-Span-583" style="font-family: MathJax_Main; padding-left: 0.278em;">=</span><span class="munderover" id="MathJax-Span-584" style="padding-left: 0.278em;"><span style="display: inline-block; position: relative; width: 1.577em; height: 0px;"><span style="position: absolute; clip: rect(3.104em, 1001em, 4.417em, -1000em); top: -4.01em; left: 0em;"><span class="mo" id="MathJax-Span-585" style="font-family: MathJax_Size1; vertical-align: 0em;">∑</span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span><span style="position: absolute; top: -3.725em; left: 1.056em;"><span class="texatom" id="MathJax-Span-586"><span class="mrow" id="MathJax-Span-587"><span class="msup" id="MathJax-Span-588"><span style="display: inline-block; position: relative; width: 0.446em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.23em, 4.174em, -1000em); top: -4.01em; left: 0em;"><span class="mi" id="MathJax-Span-589" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">t</span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span><span style="position: absolute; top: -4.267em; left: 0.255em;"><span class="mo" id="MathJax-Span-590" style="font-size: 50%; font-family: MathJax_Main;">′</span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-591" style="padding-left: 0.167em;"><span style="display: inline-block; position: relative; width: 2.713em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.6em, 4.178em, -1000em); top: -4.01em; left: 0em;"><span class="mi" id="MathJax-Span-592" style="font-family: MathJax_Math; font-style: italic;">α</span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span><span style="position: absolute; top: -4.373em; left: 0.64em;"><span class="texatom" id="MathJax-Span-593"><span class="mrow" id="MathJax-Span-594"><span class="mo" id="MathJax-Span-595" style="font-size: 70.7%; font-family: MathJax_Main;">&lt;</span><span class="mi" id="MathJax-Span-596" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">t</span><span class="mo" id="MathJax-Span-597" style="font-size: 70.7%; font-family: MathJax_Main;">,</span><span class="msup" id="MathJax-Span-598"><span style="display: inline-block; position: relative; width: 0.446em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.23em, 4.174em, -1000em); top: -4.01em; left: 0em;"><span class="mi" id="MathJax-Span-599" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">t</span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span><span style="position: absolute; top: -4.267em; left: 0.255em;"><span class="mo" id="MathJax-Span-600" style="font-size: 50%; font-family: MathJax_Main;">′</span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span></span></span><span class="mo" id="MathJax-Span-601" style="font-size: 70.7%; font-family: MathJax_Main;">&gt;</span></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span></span></span><span class="mo" id="MathJax-Span-602" style="font-family: MathJax_Main; padding-left: 0.222em;">∗</span><span class="msubsup" id="MathJax-Span-603" style="padding-left: 0.222em;"><span style="display: inline-block; position: relative; width: 2.15em; height: 0px;"><span style="position: absolute; clip: rect(3.413em, 1000.51em, 4.177em, -1000em); top: -4.01em; left: 0em;"><span class="mi" id="MathJax-Span-604" style="font-family: MathJax_Math; font-style: italic;">a</span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span><span style="position: absolute; top: -4.373em; left: 0.529em;"><span class="texatom" id="MathJax-Span-605"><span class="mrow" id="MathJax-Span-606"><span class="mo" id="MathJax-Span-607" style="font-size: 70.7%; font-family: MathJax_Main;">&lt;</span><span class="msup" id="MathJax-Span-608"><span style="display: inline-block; position: relative; width: 0.446em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.23em, 4.174em, -1000em); top: -4.01em; left: 0em;"><span class="mi" id="MathJax-Span-609" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">t</span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span><span style="position: absolute; top: -4.267em; left: 0.255em;"><span class="mo" id="MathJax-Span-610" style="font-size: 50%; font-family: MathJax_Main;">′</span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span></span></span><span class="mo" id="MathJax-Span-611" style="font-size: 70.7%; font-family: MathJax_Main;">&gt;</span></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.24em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.414em; border-left: 0px solid; width: 0px; height: 1.556em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mi>C</mi><mrow class="MJX-TeXAtom-ORD"><mo>&lt;</mo><mi>t</mi><mo>&gt;</mo></mrow></msup><mo>=</mo><munder><mo>∑</mo><mrow class="MJX-TeXAtom-ORD"><msup><mi>t</mi><mo>′</mo></msup></mrow></munder><msup><mi>α</mi><mrow class="MJX-TeXAtom-ORD"><mo>&lt;</mo><mi>t</mi><mo>,</mo><msup><mi>t</mi><mo>′</mo></msup><mo>&gt;</mo></mrow></msup><mo>∗</mo><msup><mi>a</mi><mrow class="MJX-TeXAtom-ORD"><mo>&lt;</mo><msup><mi>t</mi><mo>′</mo></msup><mo>&gt;</mo></mrow></msup></math></span></span><script type="math/tex" id="MathJax-Element-22">C^{<t>}=\sum_{t'}\alpha^{<t,t'>}*a^{<t'>}</script></p>

<p><strong>接下来的问题就是注意力参数应该如何确定呢？</strong> <br>
<img src="https://img-blog.csdn.net/20180326122935299?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MTA0MzI0MA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述" title=""> <br>
为了保证<span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-23-Frame" tabindex="0" style="position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><munder><mo>&amp;#x2211;</mo><mrow class=&quot;MJX-TeXAtom-ORD&quot;><msup><mi>t</mi><mo>&amp;#x2032;</mo></msup></mrow></munder><msup><mi>&amp;#x03B1;</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;lt;</mo><mi>t</mi><mo>,</mo><msup><mi>t</mi><mo>&amp;#x2032;</mo></msup><mo>&amp;gt;</mo></mrow></msup><mo>=</mo><mn>1</mn></math>" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-612" style="width: 7.607em; display: inline-block;"><span style="display: inline-block; position: relative; width: 6.302em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.184em, 1006.23em, 2.689em, -1000em); top: -2.24em; left: 0em;"><span class="mrow" id="MathJax-Span-613"><span class="munderover" id="MathJax-Span-614"><span style="display: inline-block; position: relative; width: 1.577em; height: 0px;"><span style="position: absolute; clip: rect(3.104em, 1001em, 4.417em, -1000em); top: -4.01em; left: 0em;"><span class="mo" id="MathJax-Span-615" style="font-family: MathJax_Size1; vertical-align: 0em;">∑</span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span><span style="position: absolute; top: -3.725em; left: 1.056em;"><span class="texatom" id="MathJax-Span-616"><span class="mrow" id="MathJax-Span-617"><span class="msup" id="MathJax-Span-618"><span style="display: inline-block; position: relative; width: 0.446em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.23em, 4.174em, -1000em); top: -4.01em; left: 0em;"><span class="mi" id="MathJax-Span-619" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">t</span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span><span style="position: absolute; top: -4.267em; left: 0.255em;"><span class="mo" id="MathJax-Span-620" style="font-size: 50%; font-family: MathJax_Main;">′</span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-621" style="padding-left: 0.167em;"><span style="display: inline-block; position: relative; width: 2.713em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.6em, 4.178em, -1000em); top: -4.01em; left: 0em;"><span class="mi" id="MathJax-Span-622" style="font-family: MathJax_Math; font-style: italic;">α</span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span><span style="position: absolute; top: -4.373em; left: 0.64em;"><span class="texatom" id="MathJax-Span-623"><span class="mrow" id="MathJax-Span-624"><span class="mo" id="MathJax-Span-625" style="font-size: 70.7%; font-family: MathJax_Main;">&lt;</span><span class="mi" id="MathJax-Span-626" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">t</span><span class="mo" id="MathJax-Span-627" style="font-size: 70.7%; font-family: MathJax_Main;">,</span><span class="msup" id="MathJax-Span-628"><span style="display: inline-block; position: relative; width: 0.446em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.23em, 4.174em, -1000em); top: -4.01em; left: 0em;"><span class="mi" id="MathJax-Span-629" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">t</span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span><span style="position: absolute; top: -4.267em; left: 0.255em;"><span class="mo" id="MathJax-Span-630" style="font-size: 50%; font-family: MathJax_Main;">′</span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span></span></span><span class="mo" id="MathJax-Span-631" style="font-size: 70.7%; font-family: MathJax_Main;">&gt;</span></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span></span></span><span class="mo" id="MathJax-Span-632" style="font-family: MathJax_Main; padding-left: 0.278em;">=</span><span class="mn" id="MathJax-Span-633" style="font-family: MathJax_Main; padding-left: 0.278em;">1</span></span><span style="display: inline-block; width: 0px; height: 2.24em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.414em; border-left: 0px solid; width: 0px; height: 1.556em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><munder><mo>∑</mo><mrow class="MJX-TeXAtom-ORD"><msup><mi>t</mi><mo>′</mo></msup></mrow></munder><msup><mi>α</mi><mrow class="MJX-TeXAtom-ORD"><mo>&lt;</mo><mi>t</mi><mo>,</mo><msup><mi>t</mi><mo>′</mo></msup><mo>&gt;</mo></mrow></msup><mo>=</mo><mn>1</mn></math></span></span><script type="math/tex" id="MathJax-Element-23">\sum_{t'}\alpha^{<t,t'>}=1</script>我们采用了softmax，也就是把S层上一单元的预测结果<span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-24-Frame" tabindex="0" style="position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msup><mi>S</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;lt;</mo><mi>t</mi><mo>&amp;#x2212;</mo><mn>1</mn><mo>&amp;gt;</mo></mrow></msup></math>" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-634" style="width: 3.648em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.021em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.197em, 1003.02em, 2.366em, -1000em); top: -2.188em; left: 0em;"><span class="mrow" id="MathJax-Span-635"><span class="msubsup" id="MathJax-Span-636"><span style="display: inline-block; position: relative; width: 3.039em; height: 0px;"><span style="position: absolute; clip: rect(3.149em, 1000.65em, 4.189em, -1000em); top: -4.01em; left: 0em;"><span class="mi" id="MathJax-Span-637" style="font-family: MathJax_Math; font-style: italic;">S<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.032em;"></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span><span style="position: absolute; top: -4.373em; left: 0.705em;"><span class="texatom" id="MathJax-Span-638"><span class="mrow" id="MathJax-Span-639"><span class="mo" id="MathJax-Span-640" style="font-size: 70.7%; font-family: MathJax_Main;">&lt;</span><span class="mi" id="MathJax-Span-641" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">t</span><span class="mo" id="MathJax-Span-642" style="font-size: 70.7%; font-family: MathJax_Main;">−</span><span class="mn" id="MathJax-Span-643" style="font-size: 70.7%; font-family: MathJax_Main;">1</span><span class="mo" id="MathJax-Span-644" style="font-size: 70.7%; font-family: MathJax_Main;">&gt;</span></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.188em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.089em; border-left: 0px solid; width: 0px; height: 1.152em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mi>S</mi><mrow class="MJX-TeXAtom-ORD"><mo>&lt;</mo><mi>t</mi><mo>−</mo><mn>1</mn><mo>&gt;</mo></mrow></msup></math></span></span><script type="math/tex" id="MathJax-Element-24">S^{<t-1>}</script>以及所有的激活函数<span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-25-Frame" tabindex="0" style="position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msup><mi>a</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;lt;</mo><msup><mi>t</mi><mo>&amp;#x2032;</mo></msup><mo>&amp;gt;</mo></mrow></msup></math>" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-645" style="width: 2.607em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.135em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.132em, 1002.14em, 2.354em, -1000em); top: -2.188em; left: 0em;"><span class="mrow" id="MathJax-Span-646"><span class="msubsup" id="MathJax-Span-647"><span style="display: inline-block; position: relative; width: 2.15em; height: 0px;"><span style="position: absolute; clip: rect(3.413em, 1000.51em, 4.177em, -1000em); top: -4.01em; left: 0em;"><span class="mi" id="MathJax-Span-648" style="font-family: MathJax_Math; font-style: italic;">a</span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span><span style="position: absolute; top: -4.373em; left: 0.529em;"><span class="texatom" id="MathJax-Span-649"><span class="mrow" id="MathJax-Span-650"><span class="mo" id="MathJax-Span-651" style="font-size: 70.7%; font-family: MathJax_Main;">&lt;</span><span class="msup" id="MathJax-Span-652"><span style="display: inline-block; position: relative; width: 0.446em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.23em, 4.174em, -1000em); top: -4.01em; left: 0em;"><span class="mi" id="MathJax-Span-653" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">t</span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span><span style="position: absolute; top: -4.267em; left: 0.255em;"><span class="mo" id="MathJax-Span-654" style="font-size: 50%; font-family: MathJax_Main;">′</span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span></span></span><span class="mo" id="MathJax-Span-655" style="font-size: 70.7%; font-family: MathJax_Main;">&gt;</span></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.188em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.074em; border-left: 0px solid; width: 0px; height: 1.216em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mi>a</mi><mrow class="MJX-TeXAtom-ORD"><mo>&lt;</mo><msup><mi>t</mi><mo>′</mo></msup><mo>&gt;</mo></mrow></msup></math></span></span><script type="math/tex" id="MathJax-Element-25">a^{<t'>}</script>输入softmax函数，其输出为<span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-26-Frame" tabindex="0" style="position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><msup><mi>e</mi><mrow class=&quot;MJX-TeXAtom-ORD&quot;><mo>&amp;lt;</mo><mi>t</mi><mo>,</mo><msup><mi>t</mi><mo>&amp;#x2032;</mo></msup><mo>&amp;gt;</mo></mrow></msup></math>" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-656" style="width: 3.076em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.552em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.132em, 1002.55em, 2.355em, -1000em); top: -2.188em; left: 0em;"><span class="mrow" id="MathJax-Span-657"><span class="msubsup" id="MathJax-Span-658"><span style="display: inline-block; position: relative; width: 2.539em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.43em, 4.178em, -1000em); top: -4.01em; left: 0em;"><span class="mi" id="MathJax-Span-659" style="font-family: MathJax_Math; font-style: italic;">e</span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span><span style="position: absolute; top: -4.373em; left: 0.466em;"><span class="texatom" id="MathJax-Span-660"><span class="mrow" id="MathJax-Span-661"><span class="mo" id="MathJax-Span-662" style="font-size: 70.7%; font-family: MathJax_Main;">&lt;</span><span class="mi" id="MathJax-Span-663" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">t</span><span class="mo" id="MathJax-Span-664" style="font-size: 70.7%; font-family: MathJax_Main;">,</span><span class="msup" id="MathJax-Span-665"><span style="display: inline-block; position: relative; width: 0.446em; height: 0px;"><span style="position: absolute; clip: rect(3.412em, 1000.23em, 4.174em, -1000em); top: -4.01em; left: 0em;"><span class="mi" id="MathJax-Span-666" style="font-size: 70.7%; font-family: MathJax_Math; font-style: italic;">t</span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span><span style="position: absolute; top: -4.267em; left: 0.255em;"><span class="mo" id="MathJax-Span-667" style="font-size: 50%; font-family: MathJax_Main;">′</span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span></span></span><span class="mo" id="MathJax-Span-668" style="font-size: 70.7%; font-family: MathJax_Main;">&gt;</span></span></span><span style="display: inline-block; width: 0px; height: 4.01em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.188em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.076em; border-left: 0px solid; width: 0px; height: 1.218em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mi>e</mi><mrow class="MJX-TeXAtom-ORD"><mo>&lt;</mo><mi>t</mi><mo>,</mo><msup><mi>t</mi><mo>′</mo></msup><mo>&gt;</mo></mrow></msup></math></span></span><script type="math/tex" id="MathJax-Element-26">e^{<t,t'>}</script>然后再根据上图公式计算注意力参数<span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-27-Frame" tabindex="0" style="position: relative;" data-mathml="<math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;><mi>&amp;#x03B1;</mi></math>" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-669" style="width: 0.784em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.625em; height: 0px; font-size: 120%;"><span style="position: absolute; clip: rect(1.693em, 1000.59em, 2.459em, -1000em); top: -2.292em; left: 0em;"><span class="mrow" id="MathJax-Span-670"><span class="mi" id="MathJax-Span-671" style="font-family: MathJax_Math; font-style: italic;">α</span></span><span style="display: inline-block; width: 0px; height: 2.292em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.076em; border-left: 0px solid; width: 0px; height: 0.669em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>α</mi></math></span></span><script type="math/tex" id="MathJax-Element-27">\alpha</script>。</p>



<h1 id="9-speech-recognition语音识别"><a name="t8"></a>9 Speech Recognition语音识别</h1>

<p>人耳能听到声音，是因为耳朵能够捕捉气压的变化。 <br>
预处理： <br>
生成声谱图（spectrogram），为空白输出（false blank outputs）</p>

<p>以前语言学家认为用音位表示音频是做语音识别最好的方式，这种人工设计在小数据时代是必须的，但是在大数据时间人们发现在end-to-end模型中音位是不必要的，可以构建系统直接由输入的音频生成其文本。 <br>
语音识别方法： <br>
1）用注意力模型实现语音识别 <br>
<img src="https://img-blog.csdn.net/20180326143156801?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MTA0MzI0MA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述" title=""> <br>
2）CTC损失函数和语音识别 <br>
这里举例用了单向的many-to-many结构的RNN，实际中更倾向于使用LSTM/GRU的双向RNN。语音识别的一个特点是输出可能会比输入少很多，CTC可以允许有空白字符输出，而且会把空白符和其之间的重复字符折叠。 <br>
<img src="https://img-blog.csdn.net/20180326143227405?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MTA0MzI0MA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述" title=""></p>

<h1 id="10-trigger-word-detection触发文字检测"><a name="t9"></a>10 Trigger Word Detection触发文字检测</h1>

<p>这个功能玩过天猫精灵的伙伴应该很熟悉，只要你说“天猫精灵”，它就会被激活，不需要手动按开关，当你跟它说“安静”的时候，它就会停止一切活动进入睡眠状态 <br>
<img src="https://img-blog.csdn.net/20180326145228695?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MTA0MzI0MA==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="这里写图片描述" title=""> <br>
如图是解决触发文字检测的一种方法，预先设置检测标签为0，然后随着音频的输入，当检测到激活关键词的时候，就将标签置为1。</p>                